var fabric=fabric||{version:0.1};fabric.log=function(){};fabric.warn=function(){};if(typeof console!=="undefined"){if(typeof console.log!=="undefined"&&console.log.apply)fabric.log=function(){return console.log.apply(console,arguments)};if(typeof console.warn!=="undefined"&&console.warn.apply)fabric.warn=function(){return console.warn.apply(console,arguments)}}if(!this.JSON)this.JSON={};
(function(){function m(g){return g<10?"0"+g:g}function o(g){p.lastIndex=0;return p.test(g)?'"'+g.replace(p,function(n){var q=a[n];return typeof q==="string"?q:"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+g+'"'}function f(g,n){var q,s,w,y,A=l,u,v=n[g];if(v&&typeof v==="object"&&typeof v.toJSON==="function")v=v.toJSON(g);if(typeof c==="function")v=c.call(n,g,v);switch(typeof v){case "string":return o(v);case "number":return isFinite(v)?String(v):"null";case "boolean":case "null":return String(v);
case "object":if(!v)return"null";l+=e;u=[];if(Object.prototype.toString.apply(v)==="[object Array]"){y=v.length;for(q=0;q<y;q+=1)u[q]=f(q,v)||"null";w=u.length===0?"[]":l?"[\n"+l+u.join(",\n"+l)+"\n"+A+"]":"["+u.join(",")+"]";l=A;return w}if(c&&typeof c==="object"){y=c.length;for(q=0;q<y;q+=1){s=c[q];if(typeof s==="string")if(w=f(s,v))u.push(o(s)+(l?": ":":")+w)}}else for(s in v)if(Object.hasOwnProperty.call(v,s))if(w=f(s,v))u.push(o(s)+(l?": ":":")+w);w=u.length===0?"{}":l?"{\n"+l+u.join(",\n"+l)+
"\n"+A+"}":"{"+u.join(",")+"}";l=A;return w}}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+m(this.getUTCMonth()+1)+"-"+m(this.getUTCDate())+"T"+m(this.getUTCHours())+":"+m(this.getUTCMinutes())+":"+m(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()}}var h=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,
p=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l,e,a={"\u0008":"\\b","\t":"\\t","\n":"\\n","\u000c":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c;if(typeof JSON.stringify!=="function")JSON.stringify=function(g,n,q){var s;e=l="";if(typeof q==="number")for(s=0;s<q;s+=1)e+=" ";else if(typeof q==="string")e=q;if((c=n)&&typeof n!=="function"&&(typeof n!=="object"||typeof n.length!=="number"))throw Error("JSON.stringify");return f("",
{"":g})};if(typeof JSON.parse!=="function")JSON.parse=function(g,n){function q(w,y){var A,u,v=w[y];if(v&&typeof v==="object")for(A in v)if(Object.hasOwnProperty.call(v,A)){u=q(v,A);if(u!==undefined)v[A]=u;else delete v[A]}return n.call(w,y,v)}var s;g=String(g);h.lastIndex=0;if(h.test(g))g=g.replace(h,function(w){return"\\u"+("0000"+w.charCodeAt(0).toString(16)).slice(-4)});if(/^[\],:{}\s]*$/.test(g.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,
"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){s=eval("("+g+")");return typeof n==="function"?q({"":s},""):s}throw new SyntaxError("JSON.parse");}})();(function(){var m=document.defaultView;if(m&&m.getComputedStyle)if(m.getComputedStyle(document.documentElement,"")===null)m.getComputedStyle=function(o){return o.style}})();
var Cufon=function(){function m(t){var b=this.face=t.face;this.glyphs=t.glyphs;this.w=t.w;this.baseSize=parseInt(b["units-per-em"],10);this.family=b["font-family"].toLowerCase();this.weight=b["font-weight"];this.style=b["font-style"]||"normal";this.viewBox=function(){var d=b.bbox.split(/\s+/);d={minX:parseInt(d[0],10),minY:parseInt(d[1],10),maxX:parseInt(d[2],10),maxY:parseInt(d[3],10)};d.width=d.maxX-d.minX;d.height=d.maxY-d.minY;d.toString=function(){return[this.minX,this.minY,this.width,this.height].join(" ")};
return d}();this.ascent=-parseInt(b.ascent,10);this.descent=-parseInt(b.descent,10);this.height=-this.ascent+this.descent}function o(){var t={},b={oblique:"italic",italic:"oblique"};this.add=function(d){(t[d.style]||(t[d.style]={}))[d.weight]=d};this.get=function(d,k){var r=t[d]||t[b[d]]||t.normal||t.italic||t.oblique;if(!r)return null;k={normal:400,bold:700}[k]||parseInt(k,10);if(r[k])return r[k];var x={1:1,99:0}[k%100],z=[],B,C;if(x===undefined)x=k>400;if(k==500)k=400;for(var G in r){G=parseInt(G,
10);if(!B||G<B)B=G;if(!C||G>C)C=G;z.push(G)}if(k<B)k=B;if(k>C)k=C;z.sort(function(F,H){return(x?F>k&&H>k?F<H:F>H:F<k&&H<k?F>H:F<H)?-1:1});return r[z[0]]}}function f(t){var b={},d={};this.get=function(k){return b[k]!=undefined?b[k]:t[k]};this.getSize=function(k,r){return d[k]||(d[k]=new q.Size(this.get(k),r))};this.extend=function(k){for(var r in k)b[r]=k[r];return this}}function h(t,b,d){if(t.addEventListener)t.addEventListener(b,d,false);else t.attachEvent&&t.attachEvent("on"+b,function(){return d.call(t,
window.event)})}function p(t){var b={};return function(d){b.hasOwnProperty(d)||(b[d]=t.apply(null,arguments));return b[d]}}function l(t){return document.getElementsByTagName(t)}function e(){for(var t={},b,d=0,k=arguments.length;d<k;++d)for(b in arguments[d])t[b]=arguments[d][b];return t}function a(t,b,d,k,r,x){var z=k.separate;if(z=="none")return u[k.engine].apply(null,arguments);var B=document.createDocumentFragment(),C=b.split(D[z]),G=z=="words";if(G&&s){/^\s/.test(b)&&C.unshift("");/\s$/.test(b)&&
C.push("")}for(var F=0,H=C.length;F<H;++F)(z=u[k.engine](t,G?q.textAlign(C[F],d,F,H):C[F],d,k,r,x,F<H-1))&&B.appendChild(z);return B}function c(t,b){var d,k,r,x;r=w.get(t);if(!r.options){b.hover&&b.hoverables[t.nodeName.toLowerCase()]&&y.attach(t);r.options=b}for(var z=t.firstChild;z;z=r){r=z.nextSibling;x=false;if(z.nodeType==1){if(!z.firstChild)continue;if(/cufon/.test(z.className))x=true;else{arguments.callee(z,b);continue}}k||(k=q.getStyle(t).extend(b));if(!d)a:{(d=k)||(d=q.getStyle(t));for(var B=
q.quotedList(d.get("fontFamily").toLowerCase()),C=void 0,G=0,F=B.length;G<F;++G){C=B[G];if(v[C]){d=v[C].get(d.get("fontStyle"),d.get("fontWeight"));break a}}d=null}if(d)if(x)u[b.engine](d,null,k,b,z,t);else{x=z.data;if(x!=="")(x=a(d,x,k,b,z,t))?z.parentNode.replaceChild(x,z):z.parentNode.removeChild(z)}}}var g=function(){return g.replace.apply(null,arguments)},n=g.DOM={ready:function(){var t=false,b={loaded:1,complete:1},d=[],k=function(){if(!t){t=true;for(var r;r=d.shift();r());}};if(document.addEventListener){document.addEventListener("DOMContentLoaded",
k,false);window.addEventListener("pageshow",k,false)}!window.opera&&document.readyState&&function(){b[document.readyState]?k():setTimeout(arguments.callee,10)}();document.readyState&&document.createStyleSheet&&function(){try{document.body.doScroll("left");k()}catch(r){setTimeout(arguments.callee,1)}}();h(window,"load",k);return function(r){if(arguments.length)t?r():d.push(r);else k()}}()},q=g.CSS={Size:function(t,b){this.value=parseFloat(t);this.unit=String(t).match(/[a-z%]*$/)[0]||"px";this.convert=
function(d){return d/b*this.value};this.convertFrom=function(d){return d/this.value*b};this.toString=function(){return this.value+this.unit}},getStyle:function(t){return new f(t.style)},quotedList:p(function(t){for(var b=[],d=/\s*((["'])([\s\S]*?[^\\])\2|[^,]+)\s*/g,k;k=d.exec(t);)b.push(k[3]||k[1]);return b}),ready:function(){var t=false,b=[],d=Object.prototype.propertyIsEnumerable?l("style"):{length:0},k=l("link");n.ready(function(){for(var r=0,x,z=0,B=k.length;x=k[z],z<B;++z)!x.disabled&&x.rel.toLowerCase()==
"stylesheet"&&++r;if(document.styleSheets.length>=d.length+r)for(t=true;r=b.shift();r());else setTimeout(arguments.callee,10)});return function(r){t?r():b.push(r)}}(),supports:function(t,b){var d=document.createElement("span").style;if(d[t]===undefined)return false;d[t]=b;return d[t]===b},textAlign:function(t,b,d,k){if(b.get("textAlign")=="right"){if(d>0)t=" "+t}else if(d<k-1)t+=" ";return t},textDecoration:function(t,b){b||(b=this.getStyle(t));for(var d={underline:null,overline:null,"line-through":null},
k=t;k.parentNode&&k.parentNode.nodeType==1;){var r=true;for(var x in d)if(!d[x]){if(b.get("textDecoration").indexOf(x)!=-1)d[x]=b.get("color");r=false}if(r)break;b=this.getStyle(k=k.parentNode)}return d},textShadow:p(function(t){if(t=="none")return null;for(var b=[],d={},k,r=0,x=/(#[a-f0-9]+|[a-z]+\(.*?\)|[a-z]+)|(-?[\d.]+[a-z%]*)|,/ig;k=x.exec(t);)if(k[0]==","){b.push(d);d={};r=0}else if(k[1])d.color=k[1];else d[["offX","offY","blur"][r++]]=k[2];b.push(d);return b}),color:p(function(t){var b={};
b.color=t.replace(/^rgba\((.*?),\s*([\d.]+)\)/,function(d,k,r){b.opacity=parseFloat(r);return"rgb("+k+")"});return b}),textTransform:function(t,b){return t[{uppercase:"toUpperCase",lowercase:"toLowerCase"}[b.get("textTransform")]||"toString"]()}},s=" ".split(/\s+/).length==0,w=new function(){var t={},b=0;this.get=function(d){d=d.cufid||(d.cufid=++b);return t[d]||(t[d]={})}},y=new (function(){function t(k){k=k.relatedTarget;var r;if(!(r=!k))r=this.contains?this.contains(k):this.compareDocumentPosition(k)&
16;r||d(this)}function b(){d(this)}function d(k){setTimeout(function(){g.replace(k,w.get(k).options,true)},10)}this.attach=function(k){if(k.onmouseenter===undefined){h(k,"mouseover",t);h(k,"mouseout",t)}else{h(k,"mouseenter",b);h(k,"mouseleave",b)}}}),A=[],u={},v={},E={enableTextDecoration:false,engine:null,hover:false,hoverables:{a:true},printable:true,selector:window.Sizzle||window.jQuery&&function(t){return jQuery(t)}||window.dojo&&dojo.query||window.$$&&function(t){return $$(t)}||window.$&&function(t){return $(t)}||
document.querySelectorAll&&function(t){return document.querySelectorAll(t)}||l,separate:"words",textShadow:"none"},D={words:/\s+/,characters:""};g.now=function(){n.ready();return g};g.refresh=function(){for(var t=A.splice(0,A.length),b=0,d=t.length;b<d;++b)g.replace.apply(null,t[b]);return g};g.registerEngine=function(t,b){if(!b)return g;u[t]=b;return g.set("engine",t)};g.registerFont=function(t){t=new m(t);var b=t.family;v[b]||(v[b]=new o);v[b].add(t);return g.set("fontFamily",'"'+b+'"')};g.replace=
function(t,b,d){b=e(E,b);if(!b.engine)return g;if(typeof b.textShadow=="string")b.textShadow=q.textShadow(b.textShadow);d||A.push(arguments);if(t.nodeType||typeof t=="string")t=[t];q.ready(function(){for(var k=0,r=t.length;k<r;++k){var x=t[k];typeof x=="string"?g.replace(b.selector(x),b,true):c(x,b)}});return g};g.replaceElement=function(t,b){b=e(E,b);if(typeof b.textShadow=="string")b.textShadow=q.textShadow(b.textShadow);return c(t,b)};g.engines=u;g.fonts=v;g.getOptions=function(){return e(E)};
g.set=function(t,b){E[t]=b;return g};return g}();
Cufon.registerEngine("canvas",function(){var m=document.createElement("canvas");if(!(!m||!m.getContext||!m.getContext.apply)){m=null;var o=Cufon.CSS.supports("display","inline-block");m=!o&&(document.compatMode=="BackCompat"||/frameset|transitional/i.test(document.doctype.publicId));var f=document.createElement("style");f.type="text/css";f.appendChild(document.createTextNode(".cufon-canvas{text-indent:0}@media screen,projection{.cufon-canvas{display:inline;display:inline-block;position:relative;vertical-align:middle"+(m?
"":";font-size:1px;line-height:1px")+"}.cufon-canvas .cufon-alt{display:-moz-inline-box;display:inline-block;width:0;height:0;overflow:hidden}"+(o?".cufon-canvas canvas{position:relative}":".cufon-canvas canvas{position:absolute}")+"}@media print{.cufon-canvas{padding:0 !important}.cufon-canvas canvas{display:none}.cufon-canvas .cufon-alt{display:inline}}"));document.getElementsByTagName("head")[0].appendChild(f);return function(h,p,l,e,a,c){function g(C,G){B.strokeStyle=G;B.beginPath();B.moveTo(0,
C);B.lineTo(z,C);B.stroke()}function n(){for(var C=0,G=x.length;C<G;++C){var F=h.glyphs[x[C]]||h.missingGlyph;if(F){B.beginPath();if(F.d)if(F.code)for(var H=F.code,L=B,I=0,M=H.length;I<M;++I){var K=H[I];L[K.m].apply(L,K.a)}else{H=F;L="m"+F.d;I=B;K=M=0;var N=[],Q=/([mrvxe])([^a-z]*)/g,P=void 0,O=0;a:for(;P=Q.exec(L);++O){var J=P[2].split(",");switch(P[1]){case "v":N[O]={m:"bezierCurveTo",a:[M+~~J[0],K+~~J[1],M+~~J[2],K+~~J[3],M+=~~J[4],K+=~~J[5]]};break;case "r":N[O]={m:"lineTo",a:[M+=~~J[0],K+=~~J[1]]};
break;case "m":N[O]={m:"moveTo",a:[M=~~J[0],K=~~J[1]]};break;case "x":N[O]={m:"closePath"};break;case "e":break a}I[N[O].m].apply(I,N[O].a)}H.code=N}B.fill();B.translate(Number(F.w||h.w)+y,0)}}}var q=p===null,s=h.viewBox,w=l.getSize("fontSize",h.baseSize),y=l.get("letterSpacing");y=y=="normal"?0:w.convertFrom(parseInt(y,10));var A=0,u=0,v=0,E=0,D=e.textShadow,t=[];if(D)for(var b=0,d=D.length;b<d;++b){var k=D[b],r=w.convertFrom(parseFloat(k.offX));k=w.convertFrom(parseFloat(k.offY));t[b]=[r,k];if(k<
A)A=k;if(r>u)u=r;if(k>v)v=k;if(r<E)E=r}var x=Cufon.CSS.textTransform(q?a.alt:p,l).split(""),z=0;k=null;b=0;for(d=x.length;b<d;++b)if(r=h.glyphs[x[b]]||h.missingGlyph)z+=k=Number(r.w||h.w)+y;if(k===null)return null;u+=s.width-k;E+=s.minX;if(q){q=a;b=a.firstChild}else{q=document.createElement("span");q.className="cufon cufon-canvas";q.alt=p;b=document.createElement("canvas");q.appendChild(b);if(e.printable){d=document.createElement("span");d.className="cufon-alt";d.appendChild(document.createTextNode(p));
q.appendChild(d)}}p=q.style;d=b.style;a=w.convert(s.height-A+v);v=Math.ceil(a);a=v/a;b.width=Math.ceil(w.convert(z+u-E)*a);b.height=v;A+=s.minY;d.top=Math.round(w.convert(A-h.ascent))+"px";d.left=Math.round(w.convert(E))+"px";u=Math.ceil(w.convert(z*a));d=u+"px";w=w.convert(h.height);Cufon.textOptions.width=u;Cufon.textOptions.height=w;if(o){p.width=d;p.height=w+"px"}else{p.paddingLeft=d;p.paddingBottom=w-1+"px"}var B=Cufon.textOptions.context||b.getContext("2d");s=v/s.height;B.save();B.scale(s,s);
B.translate(-E-1/s*b.width/2+(Cufon.fonts[h.family].offsetLeft||0),-A-1/s*b.height/2);B.lineWidth=h.face["underline-thickness"];B.save();e=e.enableTextDecoration?Cufon.CSS.textDecoration(c,l):{};e.underline&&g(-h.face["underline-position"],e.underline);e.overline&&g(h.ascent,e.overline);B.fillStyle=Cufon.textOptions.color||l.get("color");if(D){b=0;for(d=D.length;b<d;++b){k=D[b];B.save();B.fillStyle=k.color;B.translate.apply(B,t[b]);n();B.restore()}}n();B.restore();B.restore();e["line-through"]&&g(-h.descent,
e["line-through"]);return q}}}());
Cufon.registerEngine("vml",function(){function m(f,h){if(/px$/i.test(h))return parseFloat(h);var p=f.style.left,l=f.runtimeStyle.left;f.runtimeStyle.left=f.currentStyle.left;f.style.left=h;var e=f.style.pixelLeft;f.style.left=p;f.runtimeStyle.left=l;return e}if(document.namespaces){document.namespaces.cvml==null&&document.namespaces.add("cvml","urn:schemas-microsoft-com:vml");var o=document.createElement("cvml:shape");o.style.behavior="url(#default#VML)";if(o.coordsize){o=null;document.write('<style type="text/css">.cufon-vml-canvas{text-indent:0}@media screen{cvml\\:shape,cvml\\:shadow{behavior:url(#default#VML);display:block;antialias:true;position:absolute}.cufon-vml-canvas{position:absolute;text-align:left}.cufon-vml{display:inline-block;position:relative;vertical-align:middle}.cufon-vml .cufon-alt{position:absolute;left:-10000in;font-size:1px}a .cufon-vml{cursor:pointer}}@media print{.cufon-vml *{display:none}.cufon-vml .cufon-alt{display:inline}}</style>');
return function(f,h,p,l,e,a,c){var g=h===null;if(g)h=e.alt;var n=f.viewBox,q;if(!(q=p.computedFontSize)){q=Cufon.CSS.Size;var s;s=p.get("fontSize");s=m(a,/(?:em|ex|%)$/i.test(s)?"1em":s);q=p.computedFontSize=new q(s+"px",f.baseSize)}q=q;s=p.computedLSpacing;if(s==undefined){s=p.get("letterSpacing");p.computedLSpacing=s=s=="normal"?0:~~q.convertFrom(m(a,s))}var w;if(g){w=e;e=e.firstChild}else{w=document.createElement("span");w.className="cufon cufon-vml";w.alt=h;e=document.createElement("span");e.className=
"cufon-vml-canvas";w.appendChild(e);if(l.printable){var y=document.createElement("span");y.className="cufon-alt";y.appendChild(document.createTextNode(h));w.appendChild(y)}c||w.appendChild(document.createElement("cvml:shape"))}c=w.style;var A=e.style,u=q.convert(n.height);y=Math.ceil(u);u=y/u;var v=n.minX,E=n.minY;A.height=y;A.top=Math.round(q.convert(E-f.ascent));A.left=Math.round(q.convert(v));c.height=q.convert(f.height)+"px";l.enableTextDecoration&&Cufon.CSS.textDecoration(a,p);a=p.get("color");
h=Cufon.CSS.textTransform(h,p).split("");A=p=0;var D=null,t;l=l.textShadow;for(var b=0,d=0,k=h.length;b<k;++b)if(t=f.glyphs[h[b]]||f.missingGlyph)p+=D=~~(t.w||f.w)+s;if(D===null)return null;t=-v+p+(n.width-D);b=q.convert(t*u);D=Math.round(b);var r=t+","+n.height,x,z="r"+r+"nsnf";for(b=0;b<k;++b)if(t=f.glyphs[h[b]]||f.missingGlyph){if(g){n=e.childNodes[d];n.firstChild&&n.removeChild(n.firstChild)}else{n=document.createElement("cvml:shape");e.appendChild(n)}n.stroked="f";n.coordsize=r;n.coordorigin=
x=v-A+","+E;n.path=(t.d?"m"+t.d+"xe":"")+"m"+x+z;n.fillcolor=a;x=n.style;x.width=D;x.height=y;if(l){x=l[0];var B=l[1],C=Cufon.CSS.color(x.color),G,F=document.createElement("cvml:shadow");F.on="t";F.color=C.color;F.offset=x.offX+","+x.offY;if(B){G=Cufon.CSS.color(B.color);F.type="double";F.color2=G.color;F.offset2=B.offX+","+B.offY}F.opacity=C.opacity||G&&G.opacity||1;n.appendChild(F)}A+=~~(t.w||f.w)+s;++d}c.width=Math.max(Math.ceil(q.convert(p*u)),0);return w}}}}());
(function(){function m(l,e){for(var a in e)l[a]=e[a];return l}function o(l,e){var a=document.createElement(l);for(var c in e)if(c==="class")a.className=e[c];else if(c==="for")a.htmlFor=e[c];else a.setAttribute(c,e[c]);return a}var f=this.fabric||(this.fabric={}),h=Array.prototype.slice,p=Function.prototype.apply;f.util={};(function(){var l=Math.PI/180;f.util.removeFromArray=function(e,a){var c=e.indexOf(a);c!==-1&&e.splice(c,1);return e};f.util.degreesToRadians=function(e){return e*l};f.util.toFixed=
function(e,a){return parseFloat(Number(e).toFixed(a))};f.util.getRandomInt=function(e,a){return Math.floor(Math.random()*(a-e+1))+e};f.util.falseFunction=function(){return false}})();if(!Array.prototype.indexOf)Array.prototype.indexOf=function(l,e){var a=this.length>>>0;e=Number(e)||0;e=Math[e<0?"ceil":"floor"](e);if(e<0)e+=a;for(;e<a;e++)if(e in this&&this[e]===l)return e;return-1};if(!Array.prototype.forEach)Array.prototype.forEach=function(l,e){for(var a=0,c=this.length>>>0;a<c;a++)a in this&&
l.call(e,this[a],a,this)};if(!Array.prototype.map)Array.prototype.map=function(l,e){for(var a=[],c=0,g=this.length>>>0;c<g;c++)if(c in this)a[c]=l.call(e,this[c],c,this);return a};if(!Array.prototype.every)Array.prototype.every=function(l,e){for(var a=0,c=this.length>>>0;a<c;a++)if(a in this&&!l.call(e,this[a],a,this))return false;return true};if(!Array.prototype.some)Array.prototype.some=function(l,e){for(var a=0,c=this.length>>>0;a<c;a++)if(a in this&&l.call(e,this[a],a,this))return true;return false};
if(!Array.prototype.filter)Array.prototype.filter=function(l,e){for(var a=[],c,g=0,n=this.length>>>0;g<n;g++)if(g in this){c=this[g];l.call(e,c,g,this)&&a.push(c)}return a};if(!Array.prototype.reduce)Array.prototype.reduce=function(l){var e=this.length>>>0,a=0,c;if(arguments.length>1)c=arguments[1];else{do{if(a in this){c=this[a++];break}if(++a>=e)throw new TypeError;}while(1)}for(;a<e;a++)if(a in this)c=l.call(null,c,this[a],a,this);return c};f.util.array={invoke:function(l,e){for(var a=h.call(arguments,
2),c=[],g=0,n=l.length;g<n;g++)c[g]=a.length?l[g][e].apply(l[g],a):l[g][e].call(l[g]);return c},min:function(l,e){var a=l.length-1,c=e?l[a][e]:l[a];if(e)for(;a--;){if(l[a][e]<c)c=l[a][e]}else for(;a--;)if(l[a]<c)c=l[a];return c},max:function(l,e){var a=l.length-1,c=e?l[a][e]:l[a];if(e)for(;a--;){if(l[a][e]>=c)c=l[a][e]}else for(;a--;)if(l[a]>=c)c=l[a];return c}};f.util.object={extend:m,clone:function(l){return m({},l)}};if(!String.prototype.trim)String.prototype.trim=function(){return this.replace(/^[\s\xA0]+/,
"").replace(/[\s\xA0]+$/,"")};f.util.string={camelize:function(l){return l.replace(/-+(.)?/g,function(e,a){return a?a.toUpperCase():""})},capitalize:function(l){return l.charAt(0).toUpperCase()+l.slice(1).toLowerCase()}};if(!Function.prototype.bind)Function.prototype.bind=function(l){var e=this,a=h.call(arguments,1);return a.length?function(){return p.call(e,l,a.concat(h.call(arguments)))}:function(){return p.call(e,l,arguments)}};(function(){function l(){}var e;e=function(){for(var a in{toString:1})if(a===
"toString")return false;return true}()?function(a,c){if(c.toString!==Object.prototype.toString)a.prototype.toString=c.toString;if(c.valueOf!==Object.prototype.valueOf)a.prototype.valueOf=c.valueOf;for(var g in c)a.prototype[g]=c[g]}:function(a,c){for(var g in c)a.prototype[g]=c[g]};f.util.createClass=function(){function a(){this.initialize.apply(this,arguments)}var c=null,g=h.call(arguments,0);if(typeof g[0]==="function")c=g.shift();a.superclass=c;a.subclasses=[];if(c){l.prototype=c.prototype;a.prototype=
new l;c.subclasses.push(a)}c=0;for(var n=g.length;c<n;c++)e(a,g[c]);if(!a.prototype.initialize)a.prototype.initialize=emptyFunction;return a.prototype.constructor=a}})();(function(){function l(u){var v=Array.prototype.slice.call(arguments,1),E,D,t=v.length;for(D=0;D<t;D++){E=typeof u[v[D]];if(!/^(?:function|object|unknown)$/.test(E))return false}return true}function e(u,v){return function(E){v.call(g(u),E||window.event)}}function a(u,v){return function(E){if(y[u]&&y[u][v])for(var D=y[u][v],t=0,b=
D.length;t<b;t++)D[t].call(this,E||window.event)}}var c=function(){if(typeof document.documentElement.uniqueID!=="undefined")return function(v){return v.uniqueID};var u=0;return function(v){return v.__uniqueID||(v.__uniqueID="uniqueID__"+u++)}}(),g,n;(function(){var u={};g=function(v){return u[v]};n=function(v,E){u[v]=E}})();var q=l(document.documentElement,"addEventListener","removeEventListener")&&l(window,"addEventListener","removeEventListener"),s=l(document.documentElement,"attachEvent","detachEvent")&&
l(window,"attachEvent","detachEvent"),w={},y={};if(q){q=function(u,v,E){u.addEventListener(v,E,false)};s=function(u,v,E){u.removeEventListener(v,E,false)}}else if(s){q=function(u,v,E){var D=c(u);n(D,u);w[D]||(w[D]={});w[D][v]||(w[D][v]=[]);E={handler:E,wrappedHandler:e(D,E)};w[D][v].push(E);u.attachEvent("on"+v,E.wrappedHandler)};s=function(u,v,E){var D=c(u),t;if(w[D]&&w[D][v])for(var b=0,d=w[D][v].length;b<d;b++)if((t=w[D][v][b])&&t.handler===E){u.detachEvent("on"+v,t.wrappedHandler);w[D][v][b]=
null}}}else{q=function(u,v,E){var D=c(u);y[D]||(y[D]={});if(!y[D][v]){y[D][v]=[];var t=u["on"+v];t&&y[D][v].push(t);u["on"+v]=a(D,v)}y[D][v].push(E)};s=function(u,v,E){u=c(u);if(y[u]&&y[u][v]){v=y[u][v];u=0;for(var D=v.length;u<D;u++)v[u]===E&&v.splice(u,1)}}}f.util.addListener=q;f.util.removeListener=s;var A={};f.util.getPointer=function(u){var v=document.documentElement,E=document.body||{scrollLeft:0},D=document.documentElement,t=document.body||{scrollTop:0};return{x:u.pageX||(typeof u.clientX!=
"unknown"?u.clientX:0)+(v.scrollLeft||E.scrollLeft)-(v.clientLeft||0),y:u.pageY||(typeof u.clientY!="unknown"?u.clientY:0)+(D.scrollTop||t.scrollTop)-(D.clientTop||0)}};f.util.observeEvent=function(u,v){A[u]||(A[u]=[]);A[u].push(v)};f.util.fireEvent=function(u,v){var E=A[u];if(E)for(var D=0,t=E.length;D<t;D++)E[D]({memo:v})}})(this);(function(){var l=document.createElement("div"),e=typeof l.style.filter==="string",a=/alpha\s*\(\s*opacity\s*=\s*([^\)]+)\)/,c=function(g){return g};if(typeof l.style.opacity===
"string")c=function(g,n){g.style.opacity=n;return g};else if(e)c=function(g,n){var q=g.style;if(g.currentStyle&&!g.currentStyle.hasLayout)q.zoom=1;if(a.test(q.filter)){n=n>=0.9999?"":"alpha(opacity="+n*100+")";q.filter=q.filter.replace(a,n)}else q.filter+=" alpha(opacity="+n*100+")";return g};f.util.setStyle=function(g,n){var q=g.style;if(typeof n==="string"){g.style.cssText+=";"+n;return n.indexOf("opacity")>-1?c(g,n.match(/opacity:\s*(\d?\.?\d*)/)[1]):g}for(var s in n)if(s==="opacity")c(g,n[s]);
else q[s==="float"||s==="cssFloat"?typeof q.styleFloat==="undefined"?"cssFloat":"styleFloat":s]=n[s];return g}})();(function(){var l=document.documentElement.style,e="userSelect"in l?"userSelect":"MozUserSelect"in l?"MozUserSelect":"WebkitUserSelect"in l?"WebkitUserSelect":"KhtmlUserSelect"in l?"KhtmlUserSelect":"";f.util.makeElementUnselectable=function(a){if(typeof a.onselectstart!=="undefined")a.onselectstart=f.util.falseFunction;if(e)a.style[e]="none";else if(typeof a.unselectable=="string")a.unselectable=
"on";return a}})();(function(){function l(a,c){e.load(a);c()}f.util.getScript=function(a,c){var g=document.getElementsByTagName("head")[0],n=document.createElement("script"),q=true;n.type="text/javascript";n.setAttribute("runat","server");n.onload=n.onreadystatechange=function(s){if(q)if(!(typeof this.readyState=="string"&&this.readyState!=="loaded"&&this.readyState!=="complete")){q=false;c(s||window.event);n=n.onload=n.onreadystatechange=null}};n.src=a;g.appendChild(n)};var e=this.Jaxer;if(e&&e.load)f.util.getScript=
l})();f.util.getById=function(l){return typeof l==="string"?document.getElementById(l):l};f.util.toArray=function(l){for(var e=[],a=l.length;a--;)e[a]=l[a];return e};f.util.makeElement=o;f.util.addClass=function(l,e){if((" "+l.className+" ").indexOf(" "+e+" ")===-1)l.className+=(l.className?" ":"")+e};f.util.wrapElement=function(l,e,a){if(typeof e==="string")e=o(e,a);l.parentNode&&l.parentNode.replaceChild(e,l);e.appendChild(l);return e};f.util.getElementOffset=function(l){var e=0,a=0;do{e+=l.offsetTop||
0;a+=l.offsetLeft||0;l=l.offsetParent}while(l);return{left:a,top:e}};f.util.animate=function(l){l||(l={});var e=+new Date,a=l.duration||500,c=e+a,g,n,q=l.onChange||function(){},s=l.easing||function(v){return-Math.cos(v*Math.PI)/2+0.5},w="startValue"in l?l.startValue:0,y="endValue"in l?l.endValue:100,A=w>y;l.onStart&&l.onStart();var u=setInterval(function(){g=+new Date;n=g>c?1:(g-e)/a;q(A?w-(w-y)*s(n):w+(y-w)*s(n));if(g>c){clearInterval(u);l.onComplete&&l.onComplete()}},10)};(function(){function l(){}
var e=function(){for(var a=[function(){return new ActiveXObject("Microsoft.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP")},function(){return new ActiveXObject("Msxml2.XMLHTTP.3.0")},function(){return new XMLHttpRequest}],c=a.length;c--;)try{if(a[c]())return a[c]}catch(g){}}();f.util.request=function(a,c){c||(c={});var g=c.method?c.method.toUpperCase():"GET",n=c.onComplete||function(){},q=e(),s;q.onreadystatechange=function(){if(q.readyState===4){n(q);q.onreadystatechange=l}};if(g===
"GET"){s=null;if(typeof c.parameters=="string")a=a+(/\?/.test(a)?"&":"?")+c.parameters}q.open(g,a,true);if(g==="POST"||g==="PUT")q.setRequestHeader("Content-Type","application/x-www-form-urlencoded");q.send(s);return q}})()})(this);
(function(){var m=this.fabric||(this.fabric={}),o=m.util.object.extend,f=m.util.string.capitalize,h=m.util.object.clone,p={cx:"left",x:"left",cy:"top",y:"top",r:"radius","fill-opacity":"opacity","fill-rule":"fillRule","stroke-width":"strokeWidth",transform:"transformMatrix"};m.parseTransformAttribute=function(){function l(q,s){var w=s[0];q[0]=Math.cos(w);q[1]=Math.sin(w);q[2]=-Math.sin(w);q[3]=Math.cos(w)}function e(q,s){var w=s.length===2?s[1]:s[0];q[0]=s[0];q[3]=w}function a(q,s){q[4]=s[0];if(s.length===
2)q[5]=s[1]}var c=[1,0,0,1,0,0],g=RegExp("^\\s*(?:(?:(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))(?:(?:\\s+,?\\s*|,\\s*)(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))))*)?)\\s*$"),
n=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))");
return function(q){var s=c.concat();if(!q||q&&!g.test(q))return s;q.replace(n,function(w){var y=RegExp("(?:(?:(matrix)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(translate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(scale)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(rotate)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))(?:\\s+,?\\s*|,\\s*)((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)))?\\s*\\))|(?:(skewX)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\))|(?:(skewY)\\s*\\(\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?))\\s*\\)))").exec(w).filter(function(A){return A!==
""&&A!=null});w=y[1];y=y.slice(2).map(parseFloat);switch(w){case "translate":a(s,y);break;case "rotate":l(s,y);break;case "scale":e(s,y);break;case "skewX":s[2]=y[0];break;case "skewY":s[1]=y[0];break;case "matrix":s=y;break}});return s}}();m.parseSVGDocument=function(){var l=/^(path|circle|polygon|polyline|ellipse|rect|line)$/,e=RegExp("^\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*,?\\s*((?:[-+]?\\d+(?:\\.\\d+)?(?:e[-+]?\\d+)?)+)\\s*$");
return function(a,c){if(a){var g=m.util.toArray(a.getElementsByTagName("*")).filter(function(A){var u;if(u=l.test(A.tagName)){a:{for(A=A;A&&(A=A.parentNode);)if(A.nodeName==="pattern"){A=true;break a}A=false}u=!A}return u});if(!(!g||g&&!g.length)){var n=a.getAttribute("viewBox"),q=a.getAttribute("width"),s=a.getAttribute("height"),w=null,y=null;if(n&&(n=n.match(e))){parseInt(n[1],10);parseInt(n[2],10);w=parseInt(n[3],10);y=parseInt(n[4],10)}w=q?parseFloat(q):w;y=s?parseFloat(s):y;n={width:w,height:y};
g=m.parseElements(g,h(n));!g||g&&!g.length||c&&c(g,n)}}}}();o(m,{parseAttributes:function(l,e){if(l){var a,c,g={};if(l.parentNode&&/^g$/i.test(l.parentNode.nodeName))g=m.parseAttributes(l.parentNode,e);var n=e.reduce(function(q,s){a=l.getAttribute(s);c=parseFloat(a);if(a){if((s==="fill"||s==="stroke")&&a==="none")a="";if(s==="fill-rule")a=a==="evenodd"?"destination-over":a;if(s==="transform")a=m.parseTransformAttribute(a);if(s in p)s=p[s];q[s]=isNaN(c)?a:c}return q},{});n=o(m.parseStyleAttribute(l),
n);return o(g,n)}},parseElements:function(l,e){var a=l.map(function(c){var g=m[f(c.tagName)];if(g&&g.fromElement)try{return g.fromElement(c,e)}catch(n){m.log(n.message||n)}});return a=a.filter(function(c){return c!=null})},parseStyleAttribute:function(l){var e={};if(l=l.getAttribute("style"))if(typeof l=="string"){l=l.split(";");l.pop();e=l.reduce(function(c,g){var n=g.split(":"),q=n[0].trim();n=n[1].trim();c[q]=n;return c},{})}else for(var a in l)if(typeof l[a]!=="undefined")e[a]=l[a];return e},
parsePointsAttribute:function(l){if(!l)return null;l=l.trim();var e=l.indexOf(",")>-1;l=l.split(/\s+/);var a=[];if(e){e=0;for(var c=l.length;e<c;e++){var g=l[e].split(",");a.push({x:parseFloat(g[0]),y:parseFloat(g[1])})}}else{e=0;for(c=l.length;e<c;e+=2)a.push({x:parseFloat(l[e]),y:parseFloat(l[e+1])})}return a}})})();
(function(){function m(f,h){arguments.length>0&&this.init(f,h)}var o=this.fabric||(this.fabric={});if(o.Point)o.warn("fabric.Point is already defined");else{o.Point=m;m.prototype={constructor:m,init:function(f,h){this.x=f;this.y=h},add:function(f){return new m(this.x+f.x,this.y+f.y)},addEquals:function(f){this.x+=f.x;this.y+=f.y;return this},scalarAdd:function(f){return new m(this.x+f,this.y+f)},scalarAddEquals:function(f){this.x+=f;this.y+=f;return this},subtract:function(f){return new m(this.x-
f.x,this.y-f.y)},subtractEquals:function(f){this.x-=f.x;this.y-=f.y;return this},scalarSubtract:function(f){return new m(this.x-f,this.y-f)},scalarSubtractEquals:function(f){this.x-=f;this.y-=f;return this},multiply:function(f){return new m(this.x*f,this.y*f)},multiplyEquals:function(f){this.x*=f;this.y*=f;return this},divide:function(f){return new m(this.x/f,this.y/f)},divideEquals:function(f){this.x/=f;this.y/=f;return this},eq:function(f){return this.x==f.x&&this.y==f.y},lt:function(f){return this.x<
f.x&&this.y<f.y},lte:function(f){return this.x<=f.x&&this.y<=f.y},gt:function(f){return this.x>f.x&&this.y>f.y},gte:function(f){return this.x>=f.x&&this.y>=f.y},lerp:function(f,h){return new m(this.x+(f.x-this.x)*h,this.y+(f.y-this.y)*h)},distanceFrom:function(f){var h=this.x-f.x;f=this.y-f.y;return Math.sqrt(h*h+f*f)},min:function(f){return new m(Math.min(this.x,f.x),Math.min(this.y,f.y))},max:function(f){return new m(Math.max(this.x,f.x),Math.max(this.y,f.y))},toString:function(){return this.x+
","+this.y},setXY:function(f,h){this.x=f;this.y=h},setFromPoint:function(f){this.x=f.x;this.y=f.y},swap:function(f){var h=this.x,p=this.y;this.x=f.x;this.y=f.y;f.x=h;f.y=p}}}})();
(function(){function m(f){arguments.length>0&&this.init(f)}var o=this.fabric||(this.fabric={});if(o.Intersection)o.warn("fabric.Intersection is already defined");else{o.Intersection=m;o.Intersection.prototype={init:function(f){this.status=f;this.points=[]},appendPoint:function(f){this.points.push(f)},appendPoints:function(f){this.points=this.points.concat(f)}};o.Intersection.intersectLineLine=function(f,h,p,l){var e,a=(l.x-p.x)*(f.y-p.y)-(l.y-p.y)*(f.x-p.x);e=(h.x-f.x)*(f.y-p.y)-(h.y-f.y)*(f.x-p.x);
p=(l.y-p.y)*(h.x-f.x)-(l.x-p.x)*(h.y-f.y);if(p!=0){a=a/p;e=e/p;if(0<=a&&a<=1&&0<=e&&e<=1){e=new m("Intersection");e.points.push(new o.Point(f.x+a*(h.x-f.x),f.y+a*(h.y-f.y)))}else e=new m("No Intersection")}else e=a==0||e==0?new m("Coincident"):new m("Parallel");return e};o.Intersection.intersectLinePolygon=function(f,h,p){for(var l=new m("No Intersection"),e=p.length,a=0;a<e;a++){var c=m.intersectLineLine(f,h,p[a],p[(a+1)%e]);l.appendPoints(c.points)}if(l.points.length>0)l.status="Intersection";return l};
o.Intersection.intersectPolygonPolygon=function(f,h){for(var p=new m("No Intersection"),l=f.length,e=0;e<l;e++){var a=m.intersectLinePolygon(f[e],f[(e+1)%l],h);p.appendPoints(a.points)}if(p.points.length>0)p.status="Intersection";return p};o.Intersection.intersectPolygonRectangle=function(f,h,p){var l=h.min(p),e=h.max(p);p=new o.Point(e.x,l.y);var a=new o.Point(l.x,e.y);h=m.intersectLinePolygon(l,p,f);p=m.intersectLinePolygon(p,e,f);e=m.intersectLinePolygon(e,a,f);f=m.intersectLinePolygon(a,l,f);
l=new m("No Intersection");l.appendPoints(h.points);l.appendPoints(p.points);l.appendPoints(e.points);l.appendPoints(f.points);if(l.points.length>0)l.status="Intersection";return l}}})();
(function(){function m(f){f?this._tryParsingColor(f):this.setSource([0,0,0,1])}var o=this.fabric||(this.fabric={});if(o.Color)o.warn("fabric.Color is already defined.");else{o.Color=m;o.Color.prototype={_tryParsingColor:function(f){var h=m.sourceFromHex(f);h||(h=m.sourceFromRgb(f));h&&this.setSource(h)},getSource:function(){return this._source},setSource:function(f){this._source=f},toRgb:function(){var f=this.getSource();return"rgb("+f[0]+","+f[1]+","+f[2]+")"},toRgba:function(){var f=this.getSource();
return"rgba("+f[0]+","+f[1]+","+f[2]+","+f[3]+")"},toHex:function(){var f=this.getSource(),h=f[0].toString(16);h=h.length==1?"0"+h:h;var p=f[1].toString(16);p=p.length==1?"0"+p:p;f=f[2].toString(16);f=f.length==1?"0"+f:f;return h.toUpperCase()+p.toUpperCase()+f.toUpperCase()},getAlpha:function(){return this.getSource()[3]},setAlpha:function(f){var h=this.getSource();h[3]=f;this.setSource(h);return this},toGrayscale:function(){var f=this.getSource(),h=parseInt((f[0]*0.3+f[1]*0.59+f[2]*0.11).toFixed(0),
10);this.setSource([h,h,h,f[3]]);return this},toBlackWhite:function(f){var h=this.getSource(),p=(h[0]*0.3+h[1]*0.59+h[2]*0.11).toFixed(0);h=h[3];f=f||127;p=Number(p)<Number(f)?0:255;this.setSource([p,p,p,h]);return this},overlayWith:function(f){f instanceof m||(f=new m(f));var h=[],p=this.getAlpha(),l=this.getSource();f=f.getSource();for(var e=0;e<3;e++)h.push(Math.round(l[e]*0.5+f[e]*0.5));h[4]=p;this.setSource(h);return this}};o.Color.reRGBa=/^rgba?\((\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})(?:\s*,\s*(\d+(?:\.\d+)?))?\)$/;
o.Color.reHex=/^#?([0-9a-f]{6}|[0-9a-f]{3})$/i;o.Color.fromRgb=function(f){return m.fromSource(m.sourceFromRgb(f))};o.Color.sourceFromRgb=function(f){if(f=f.match(m.reRGBa))return[parseInt(f[1],10),parseInt(f[2],10),parseInt(f[3],10),f[4]?parseFloat(f[4]):1]};o.Color.fromRgba=m.fromRgb;o.Color.fromHex=function(f){return m.fromSource(m.sourceFromHex(f))};o.Color.sourceFromHex=function(f){if(f.match(m.reHex)){var h=f.slice(f.indexOf("#")+1),p=h.length===3;f=p?h.charAt(0)+h.charAt(0):h.substring(0,2);
var l=p?h.charAt(1)+h.charAt(1):h.substring(2,4);h=p?h.charAt(2)+h.charAt(2):h.substring(4,6);return[parseInt(f,16),parseInt(l,16),parseInt(h,16),1]}};o.Color.fromSource=function(f){var h=new m;h.setSource(f);return h}}})();
(function(){if(fabric.Element)fabric.warn("fabric.Element is already defined.");else{var m=this.window,o=m.document,f=fabric.util.object.extend,h=fabric.util.string.capitalize,p=fabric.util.string.camelize,l=fabric.util.fireEvent,e=fabric.util.getPointer,a=fabric.util.getElementOffset,c=fabric.util.removeFromArray,g=fabric.util.addListener,n=fabric.util.removeListener,q=fabric.util.array.min,s=fabric.util.array.max,w=Math.sqrt,y=Math.pow,A=Math.atan2,u=Math.abs,v=Math.min,E=Math.max,D=Error("Could not initialize `canvas` element"),
t={tr:"ne-resize",br:"se-resize",bl:"sw-resize",tl:"nw-resize",ml:"w-resize",mt:"n-resize",mr:"e-resize",mb:"s-resize"};fabric.Element=function(b,d){this._groupSelector=null;this._objects=[];this._activeGroup=this._currentTransform=this._element=this._context=null;this._freeDrawingXPoints=[];this._freeDrawingYPoints=[];this._config={width:300,height:150};d=d||{};this._initElement(b);this._initConfig(d);d.overlayImage&&this.setOverlayImage(d.overlayImage);if(d.afterRender)this.afterRender=d.afterRender;
this._createCanvasBackground();this._createCanvasContainer();this._initEvents();this.calcOffset()};f(fabric.Element.prototype,{backgroundColor:"rgba(0, 0, 0, 0)",selectionColor:"rgba(100, 100, 255, 0.3)",selectionBorderColor:"rgba(255, 255, 255, 0.3)",selectionLineWidth:1,freeDrawingColor:"rgb(0, 0, 0)",freeDrawingLineWidth:1,includeDefaultValues:true,shouldCacheImages:false,CANVAS_WIDTH:600,CANVAS_HEIGHT:600,onBeforeScaleRotate:function(){},onFpsUpdate:function(){},calcOffset:function(){this._offset=
a(this.getElement());return this},setOverlayImage:function(b,d){if(b){var k=this,r=new Image;r.onload=function(){k.overlayImage=r;d&&d();r=r.onload=null};r.src=b}return this},_initElement:function(b){this._element=fabric.util.getById(b)||o.createElement("canvas");typeof this._element.getContext==="undefined"&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(this._element);if(typeof this._element.getContext==="undefined")throw D;if(!(this.contextTop=this._element.getContext("2d")))throw D;
b=this._element.width||0;var d=this._element.height||0;this._initWrapperElement(b,d);this._setElementStyle(b,d)},_initWrapperElement:function(b,d){var k=fabric.util.wrapElement(this.getElement(),"div",{"class":"canvas_container"});fabric.util.setStyle(k,{width:b+"px",height:d+"px"});fabric.util.makeElementUnselectable(k);this.wrapper=k},_setElementStyle:function(b,d){fabric.util.setStyle(this.getElement(),{position:"absolute",width:b+"px",height:d+"px",left:0,top:0})},_initConfig:function(b){f(this._config,
b||{});this._config.width=parseInt(this._element.width,10)||0;this._config.height=parseInt(this._element.height,10)||0;this._element.style.width=this._config.width+"px";this._element.style.height=this._config.height+"px"},_initEvents:function(){var b=this;this._onMouseDown=function(d){b.__onMouseDown(d)};this._onMouseUp=function(d){b.__onMouseUp(d)};this._onMouseMove=function(d){b.__onMouseMove(d)};this._onResize=function(){b.calcOffset()};g(this._element,"mousedown",this._onMouseDown);g(o,"mousemove",
this._onMouseMove);g(o,"mouseup",this._onMouseUp);g(m,"resize",this._onResize)},_createCanvasElement:function(b){var d=o.createElement("canvas");if(d){d.className=b;b=this._element.parentNode.insertBefore(d,this._element);b.width=this.getWidth();b.height=this.getHeight();b.style.width=this.getWidth()+"px";b.style.height=this.getHeight()+"px";b.style.position="absolute";b.style.left=0;b.style.top=0;typeof d.getContext==="undefined"&&typeof G_vmlCanvasManager!=="undefined"&&G_vmlCanvasManager.initElement(d);
if(typeof d.getContext==="undefined")throw D;fabric.util.makeElementUnselectable(b);return b}},_createCanvasContainer:function(){var b=this._createCanvasElement("canvas-container");this.contextContainerEl=b;this.contextContainer=b.getContext("2d")},_createCanvasBackground:function(){var b=this._createCanvasElement("canvas-container");this._contextBackgroundEl=b;this._contextBackground=b.getContext("2d")},getWidth:function(){return this._config.width},getHeight:function(){return this._config.height},
setWidth:function(b){return this._setDimension("width",b)},setHeight:function(b){return this._setDimension("height",b)},setDimensions:function(b){for(var d in b)this._setDimension(d,b[d]);return this},_setDimension:function(b,d){this.contextContainerEl[b]=d;this.contextContainerEl.style[b]=d+"px";this._contextBackgroundEl[b]=d;this._contextBackgroundEl.style[b]=d+"px";this._element[b]=d;this._element.style[b]=d+"px";this._element.parentNode.style[b]=d+"px";this._config[b]=d;this.calcOffset();this.renderAll();
return this},__onMouseUp:function(b){if(this.isDrawingMode&&this._isCurrentlyDrawing)this._finalizeDrawingPath();else{if(this._currentTransform){var d=this._currentTransform.target;if(d._scaling){l("object:scaled",{target:d});d._scaling=false}for(var k=this._objects.length;k--;)this._objects[k].setCoords();if(d.hasStateChanged()){d.isMoving=false;l("object:modified",{target:d})}}this._currentTransform=null;this._groupSelector&&this._findSelectedObjects(b);if(k=this.getActiveGroup()){k.hasStateChanged()&&
k.containsPoint(this.getPointer(b))&&l("group:modified",{target:k});k.setObjectsCoords();k.set("isMoving",false);this._setCursor("default")}this._groupSelector=null;this.renderAll();this._setCursorFromEvent(b,d);this._setCursor("");var r=this;setTimeout(function(){r._setCursorFromEvent(b,d)},50)}},_shouldClearSelection:function(b){var d=this.findTarget(b),k=this.getActiveGroup();return!d||d&&k&&!k.contains(d)&&k!==d&&!b.shiftKey},__onMouseDown:function(b){if(this.isDrawingMode){this._prepareForDrawing(b);
this._captureDrawingPath(b)}else if(!this._currentTransform){var d=this.findTarget(b),k=this.getPointer(b),r=this.getActiveGroup();if(this._shouldClearSelection(b)){this._groupSelector={ex:k.x,ey:k.y,top:0,left:0};this.deactivateAllWithDispatch()}else{d.saveState();d._findTargetCorner(b,this._offset)&&this.onBeforeScaleRotate(d);this._setupCurrentTransform(b,d);if(b.shiftKey&&(r||this.getActiveObject()))this._handleGroupLogic(b,d);else{d!==this.getActiveGroup()&&this.deactivateAll();this.setActiveObject(d)}}this.renderAll()}},
getElement:function(){return this._element},deactivateAllWithDispatch:function(){var b=this.getActiveGroup();b&&l("before:group:destroyed",{target:b});this.deactivateAll();b&&l("after:group:destroyed");l("selection:cleared");return this},_setupCurrentTransform:function(b,d){var k="drag",r,x=e(b);if(r=d._findTargetCorner(b,this._offset))k=r==="ml"||r==="mr"?"scaleX":r==="mt"||r==="mb"?"scaleY":"rotate";this._currentTransform={target:d,action:k,scaleX:d.scaleX,scaleY:d.scaleY,offsetX:x.x-d.left,offsetY:x.y-
d.top,ex:x.x,ey:x.y,left:d.left,top:d.top,theta:d.theta,width:d.width*d.scaleX};this._currentTransform.original={left:d.left,top:d.top}},_handleGroupLogic:function(b,d){if(d.isType("group")){d=this.findTarget(b,true);if(!d||d.isType("group"))return}var k=this.getActiveGroup();if(k){if(k.contains(d)){k.remove(d);d.setActive(false);k.size()===1&&this.removeActiveGroup()}else k.add(d);l("group:selected",{target:k});k.setActive(true)}else{if(this._activeObject)if(d!==this._activeObject){this.setActiveGroup(new fabric.Group([this._activeObject,
d]));k=this.getActiveGroup()}d.setActive(true)}k&&k.saveCoords()},_prepareForDrawing:function(b){this._isCurrentlyDrawing=true;this.removeActiveObject().renderAll();b=this.getPointer(b);this._freeDrawingXPoints.length=this._freeDrawingYPoints.length=0;this._freeDrawingXPoints.push(b.x);this._freeDrawingYPoints.push(b.y);this.contextTop.beginPath();this.contextTop.moveTo(b.x,b.y);this.contextTop.strokeStyle=this.freeDrawingColor;this.contextTop.lineWidth=this.freeDrawingLineWidth;this.contextTop.lineCap=
this.contextTop.lineJoin="round"},_captureDrawingPath:function(b){b=this.getPointer(b);this._freeDrawingXPoints.push(b.x);this._freeDrawingYPoints.push(b.y);this.contextTop.lineTo(b.x,b.y);this.contextTop.stroke()},_finalizeDrawingPath:function(){this.contextTop.closePath();this._isCurrentlyDrawing=false;var b=q(this._freeDrawingXPoints),d=q(this._freeDrawingYPoints),k=s(this._freeDrawingXPoints),r=s(this._freeDrawingYPoints),x=[],z=this._freeDrawingXPoints,B=this._freeDrawingYPoints;x.push("M ",
z[0]-b," ",B[0]-d," ");for(var C=1;xPoint=z[C],yPoint=B[C];C++)x.push("L ",xPoint-b," ",yPoint-d," ");x=new fabric.Path(x.join(""));x.fill=null;x.stroke=this.freeDrawingColor;x.strokeWidth=this.freeDrawingLineWidth;this.add(x);x.set("left",b+(k-b)/2).set("top",d+(r-d)/2).setCoords();this.renderAll();l("path:created",{path:x})},__onMouseMove:function(b){if(this.isDrawingMode)this._isCurrentlyDrawing&&this._captureDrawingPath(b);else{var d=this._groupSelector;if(d!==null){var k=e(b);d.left=k.x-this._offset.left-
d.ex;d.top=k.y-this._offset.top-d.ey;this.renderTop()}else if(this._currentTransform){k=e(b);d=k.x;k=k.y;this._currentTransform.target.isMoving=true;if(this._currentTransform.action==="rotate"){b.shiftKey||this._rotateObject(d,k);this._scaleObject(d,k)}else if(this._currentTransform.action==="scaleX")this._scaleObject(d,k,"x");else this._currentTransform.action==="scaleY"?this._scaleObject(d,k,"y"):this._translateObject(d,k);this.renderAll()}else{k=this._element.style;if(d=this.findTarget(b)){this._setCursorFromEvent(b,
d);d.isActive()&&d.setCornersVisibility&&d.setCornersVisibility(true)}else{for(b=this._objects.length;b--;)this._objects[b].active||this._objects[b].setActive(false);k.cursor="default"}}}},_translateObject:function(b,d){var k=this._currentTransform.target;k.lockHorizontally||k.set("left",b-this._currentTransform.offsetX);k.lockVertically||k.set("top",d-this._currentTransform.offsetY)},_scaleObject:function(b,d,k){var r=this._currentTransform,x=this._offset,z=r.target;if(!z.lockScaling){var B=w(y(r.ey-
r.top-x.top,2)+y(r.ex-r.left-x.left,2));b=w(y(d-r.top-x.top,2)+y(b-r.left-x.left,2));z._scaling=true;if(k)if(k==="x")z.set("scaleX",r.scaleX*b/B);else k==="y"&&z.set("scaleY",r.scaleY*b/B);else{z.set("scaleX",r.scaleX*b/B);z.set("scaleY",r.scaleY*b/B)}}},_rotateObject:function(b,d){var k=this._currentTransform,r=this._offset;if(!k.target.lockRotation){var x=A(k.ey-k.top-r.top,k.ex-k.left-r.left);r=A(d-k.top-r.top,b-k.left-r.left);k.target.set("theta",r-x+k.theta)}},_setCursor:function(b){this._element.style.cursor=
b},_setCursorFromEvent:function(b,d){var k=this._element.style;if(d){var r=this.getActiveGroup();if(r=!!d._findTargetCorner&&(!r||!r.contains(d))&&d._findTargetCorner(b,this._offset))if(r in t)k.cursor=t[r];else{k.cursor="default";return false}else k.cursor="move"}else{k.cursor="default";return false}return true},_draw:function(b,d){d&&d.render(b)},_drawSelection:function(){var b=this._groupSelector,d=b.left,k=b.top,r=u(d),x=u(k);this.contextTop.fillStyle=this.selectionColor;this.contextTop.fillRect(b.ex-
(d>0?0:-d),b.ey-(k>0?0:-k),r,x);this.contextTop.lineWidth=this.selectionLineWidth;this.contextTop.strokeStyle=this.selectionBorderColor;this.contextTop.strokeRect(b.ex+0.5-(d>0?0:r),b.ey+0.5-(k>0?0:x),r,x)},_findSelectedObjects:function(){var b=[],d=this._groupSelector.ex,k=this._groupSelector.ey,r=d+this._groupSelector.left,x=k+this._groupSelector.top,z=new fabric.Point(v(d,r),v(k,x));k=new fabric.Point(E(d,r),E(k,x));r=0;for(x=this._objects.length;r<x;++r){d=this._objects[r];if(d.intersectsWithRect(z,
k)||d.isContainedWithinRect(z,k)){d.setActive(true);b.push(d)}}if(b.length===1){this.setActiveObject(b[0]);l("object:selected",{target:b[0]})}else if(b.length>1){b=new fabric.Group(b);this.setActiveGroup(b);b.saveCoords();l("group:selected",{target:b})}this.renderAll()},add:function(){this._objects.push.apply(this._objects,arguments);this.renderAll();return this},insertAt:function(b,d){this._objects.splice(d,0,b);this.renderAll();return this},getObjects:function(){return this._objects},getContext:function(){return this.contextTop},
clearContext:function(b){b.clearRect(0,0,this._config.width,this._config.height);return this},clear:function(){this._objects.length=0;this.clearContext(this.contextTop);this.clearContext(this.contextContainer);this.renderAll();return this},renderAll:function(b){var d=this._config.width,k=this._config.height,r=b?this.contextTop:this.contextContainer;this.clearContext(this.contextTop);b||this.clearContext(r);r.fillStyle=this.backgroundColor;r.fillRect(0,0,d,k);b=this._objects.length;d=this.getActiveGroup();
k=new Date;if(b)for(var x=0;x<b;++x)if(!d||d&&!d.contains(this._objects[x]))this._draw(r,this._objects[x]);d&&this._draw(this.contextTop,d);this.overlayImage&&this.contextTop.drawImage(this.overlayImage,0,0);this.onFpsUpdate(~~(1E3/(new Date-k)));this.afterRender&&this.afterRender();return this},renderTop:function(){this.clearContext(this.contextTop);this.overlayImage&&this.contextTop.drawImage(this.overlayImage,0,0);this._groupSelector&&this._drawSelection();var b=this.getActiveGroup();b&&b.render(this.contextTop);
this.afterRender&&this.afterRender();return this},containsPoint:function(b,d){var k=this.getPointer(b),r=this._normalizePointer(d,k);k=r.x;r=r.y;var x=d._getImageLines(d.oCoords);if((k=d._findCrossPoints(k,r,x))&&k%2===1||d._findTargetCorner(b,this._offset))return true;return false},_normalizePointer:function(b,d){var k=this.getActiveGroup(),r=d.x,x=d.y;if(k&&b.type!=="group"&&k.contains(b)){r-=k.left;x-=k.top}return{x:r,y:x}},findTarget:function(b,d){var k;this.getPointer(b);var r=this.getActiveGroup();
if(r&&!d&&this.containsPoint(b,r))return k=r;for(r=this._objects.length;r--;)if(this.containsPoint(b,this._objects[r])){this.relatedTarget=k=this._objects[r];break}return k},toDataURL:function(b){var d;b||(b="png");if(b==="jpeg"||b==="png"){this.renderAll(true);d=this.getElement().toDataURL("image/"+b);this.renderAll()}return d},toDataURLWithMultiplier:function(b,d){var k=this.getWidth(),r=this.getHeight(),x=k*d,z=r*d,B=this.getActiveObject();this.setWidth(x).setHeight(z);this.contextTop.scale(d,
d);B&&this.deactivateAll().renderAll();x=this.toDataURL(b);this.contextTop.scale(1/d,1/d);this.setWidth(k).setHeight(r);B&&this.setActiveObject(B);this.renderAll();return x},getPointer:function(b){b=e(b);return{x:b.x-this._offset.left,y:b.y-this._offset.top}},getCenter:function(){return{top:this.getHeight()/2,left:this.getWidth()/2}},centerObjectH:function(b){b.set("left",this.getCenter().left);this.renderAll();return this},fxCenterObjectH:function(b,d){d=d||{};var k=function(){},r=d.onComplete||
k,x=d.onChange||k,z=this;fabric.util.animate({startValue:b.get("left"),endValue:this.getCenter().left,duration:this.FX_DURATION,onChange:function(B){b.set("left",B);z.renderAll();x()},onComplete:function(){b.setCoords();r()}});return this},centerObjectV:function(b){b.set("top",this.getCenter().top);this.renderAll();return this},fxCenterObjectV:function(b,d){d=d||{};var k=function(){},r=d.onComplete||k,x=d.onChange||k,z=this;fabric.util.animate({startValue:b.get("top"),endValue:this.getCenter().top,
duration:this.FX_DURATION,onChange:function(B){b.set("top",B);z.renderAll();x()},onComplete:function(){b.setCoords();r()}});return this},straightenObject:function(b){b.straighten();this.renderAll();return this},fxStraightenObject:function(b){b.fxStraighten({onChange:this.renderAll.bind(this)});return this},toDatalessJSON:function(){return this.toDatalessObject()},toObject:function(){return this._toObjectMethod("toObject")},toDatalessObject:function(){return this._toObjectMethod("toDatalessObject")},
_toObjectMethod:function(b){return{objects:this._objects.map(function(d){if(!this.includeDefaultValues){var k=d.includeDefaultValues;d.includeDefaultValues=false}var r=d[b]();if(!this.includeDefaultValues)d.includeDefaultValues=k;return r},this),background:this.backgroundColor}},isEmpty:function(){return this._objects.length===0},loadFromJSON:function(b,d){if(b){var k=JSON.parse(b);if(!(!k||k&&!k.objects)){this.clear();var r=this;this._enlivenObjects(k.objects,function(){r.backgroundColor=k.background;
d&&d()});return this}}},_enlivenObjects:function(b,d){var k=0,r=b.filter(function(z){return z.type==="image"}).length,x=this;b.forEach(function(z,B){if(z.type)switch(z.type){case "image":case "font":fabric[h(z.type)].fromObject(z,function(G){x.insertAt(G,B);++k===r&&d&&d()});break;default:var C=fabric[p(h(z.type))];C&&C.fromObject&&x.insertAt(C.fromObject(z),B);break}});r===0&&d&&d()},loadFromDatalessJSON:function(b,d){if(b){var k=typeof b==="string"?JSON.parse(b):b;if(!(!k||k&&!k.objects)){this.clear();
this.backgroundColor=k.background;this._enlivenDatalessObjects(k.objects,d)}}},_enlivenDatalessObjects:function(b,d){function k(C,G){r.insertAt(C,G);C.setCoords();++x===z&&d&&d()}var r=this,x=0,z=b.length;z===0&&d&&d();try{b.forEach(function(C,G){var F=C.paths?"paths":"path",H=C[F];delete C[F];if(typeof H!=="string")switch(C.type){case "image":case "text":fabric[h(C.type)].fromObject(C,function(I){k(I,G)});break;default:(F=fabric[p(h(C.type))])&&F.fromObject&&k(F.fromObject(C),G);break}else if(C.type===
"image")r.loadImageFromURL(H,function(I){I.setSourcePath(H);f(I,C);I.setAngle(C.angle);k(I,G)});else if(C.type==="text"){C.path=H;var L=fabric.Text.fromObject(C);fabric.util.getScript(H,function(){Object.prototype.toString.call(m.opera)==="[object Opera]"?setTimeout(function(){k(L,G)},500):k(L,G)})}else r.loadSVGFromURL(H,function(I){I=I.length>1?new fabric.PathGroup(I,C):I[0];I.setSourcePath(H);if(!(I instanceof fabric.PathGroup)){f(I,C);typeof C.angle!=="undefined"&&I.setAngle(C.angle)}k(I,G)})},
this)}catch(B){fabric.log(B.message)}},loadImageFromURL:function(){var b={};return function(d,k){function r(){var B=o.getElementById(b[d]);B.width&&B.height?k(new fabric.Image(B)):setTimeout(r,50)}var x=this;if(b[d])r();else{var z=new Image;z.onload=function(){z.onload=null;x._resizeImageToFit(z);var B=new fabric.Image(z);k(B)};z.className="canvas-img-clone";z.src=d;if(this.shouldCacheImages)b[d]=Element.identify(z);o.body.appendChild(z)}}}(),loadSVGFromURL:function(b,d){function k(z){if(z=z.responseXML)(z=
z.documentElement)&&fabric.parseSVGDocument(z,function(B,C){x.cache.set(b,{objects:B.invoke("toObject"),options:C});d(B,C)})}function r(){fabric.log("ERROR!")}var x=this;b=b.replace(/^\n\s*/,"").replace(/\?.*$/,"").trim();this.cache.has(b,function(z){if(z)x.cache.get(b,function(B){B=x._enlivenCachedObject(B);d(B.objects,B.options)});else new Ajax.Request(b,{method:"get",onComplete:k,onFailure:r})})},_enlivenCachedObject:function(b){var d=b.objects;b=b.options;d=d.map(function(k){return fabric[h(k.type)].fromObject(k)});
return{objects:d,options:b}},remove:function(b){c(this._objects,b);this.renderAll();return b},fxRemove:function(b,d){var k=this;b.fxRemove({onChange:this.renderAll.bind(this),onComplete:function(){k.remove(b);typeof d==="function"&&d()}});return this},sendToBack:function(b){c(this._objects,b);this._objects.unshift(b);return this.renderAll()},bringToFront:function(b){c(this._objects,b);this._objects.push(b);return this.renderAll()},sendBackwards:function(b){var d=this._objects.indexOf(b),k=d;if(d!==
0){for(d=d-1;d>=0;--d)if(b.intersectsWithObject(this._objects[d])){k=d;break}c(this._objects,b);this._objects.splice(k,0,b)}return this.renderAll()},bringForward:function(b){var d=this.getObjects(),k=d.indexOf(b),r=k;if(k!==d.length-1){k=k+1;for(var x=this._objects.length;k<x;++k)if(b.intersectsWithObject(d[k])){r=k;break}c(d,b);d.splice(r,0,b)}this.renderAll()},setActiveObject:function(b){this._activeObject&&this._activeObject.setActive(false);this._activeObject=b;b.setActive(true);this.renderAll();
l("object:selected",{target:b});return this},getActiveObject:function(){return this._activeObject},removeActiveObject:function(){this._activeObject&&this._activeObject.setActive(false);this._activeObject=null;return this},setActiveGroup:function(b){this._activeGroup=b;return this},getActiveGroup:function(){return this._activeGroup},removeActiveGroup:function(){var b=this.getActiveGroup();b&&b.destroy();return this.setActiveGroup(null)},item:function(b){return this.getObjects()[b]},deactivateAll:function(){for(var b=
this.getObjects(),d=0,k=b.length;d<k;d++)b[d].setActive(false);this.removeActiveGroup();this.removeActiveObject();return this},complexity:function(){return this.getObjects().reduce(function(b,d){b+=d.complexity?d.complexity():0;return b},0)},dispose:function(){this.clear();n(this.getElement(),"mousedown",this._onMouseDown);n(o,"mouseup",this._onMouseUp);n(o,"mousemove",this._onMouseMove);n(m,"resize",this._onResize);return this},clone:function(b){var d=o.createElement("canvas");d.width=this.getWidth();
d.height=this.getHeight();var k=this.__clone||(this.__clone=new fabric.Element(d));return k.loadFromJSON(JSON.stringify(this.toJSON()),function(){b&&b(k)})},_toDataURL:function(b,d){this.clone(function(k){d(k.toDataURL(b))})},_toDataURLWithMultiplier:function(b,d,k){this.clone(function(r){k(r.toDataURLWithMultiplier(b,d))})},_resizeImageToFit:function(b){var d=b.width||b.offsetWidth,k=this.getWidth()/d;if(d)b.width=d*k},cache:{has:function(b,d){d(false)},get:function(){},set:function(){}}});fabric.Element.prototype.toString=
function(){return"#<fabric.Element ("+this.complexity()+"): { objects: "+this.getObjects().length+" }>"};f(fabric.Element,{EMPTY_JSON:'{"objects": [], "background": "white"}',toGrayscale:function(b){var d=b.getContext("2d");b=d.getImageData(0,0,b.width,b.height);var k=b.data,r=b.width,x=b.height,z,B;for(i=0;i<r;i++)for(j=0;j<x;j++){z=i*4*x+j*4;B=(k[z]+k[z+1]+k[z+2])/3;k[z]=B;k[z+1]=B;k[z+2]=B}d.putImageData(b,0,0)},supports:function(b){var d=o.createElement("canvas");typeof G_vmlCanvasManager!=="undefined"&&
G_vmlCanvasManager.initElement(d);if(!d||!d.getContext)return null;var k=d.getContext("2d");if(!k)return null;switch(b){case "getImageData":return typeof k.getImageData!=="undefined";case "toDataURL":return typeof d.toDataURL!=="undefined";default:return null}}});fabric.Element.prototype.toJSON=fabric.Element.prototype.toObject}})();
(function(){var m=this.fabric||(this.fabric={}),o=m.util.object.extend,f=m.util.object.clone,h=m.util.toFixed,p=m.util.string.capitalize,l=m.util.getPointer,e=Array.prototype.slice;if(!m.Object){m.Object=m.util.createClass({type:"object",includeDefaultValues:true,NUM_FRACTION_DIGITS:2,FX_DURATION:500,FX_TRANSITION:"decel",MIN_SCALE_LIMIT:0.1,stateProperties:"top left width height scaleX scaleY flipX flipY theta angle opacity cornersize fill overlayFill stroke strokeWidth fillRule borderScaleFactor transformMatrix".split(" "),
options:{top:0,left:0,width:100,height:100,scaleX:1,scaleY:1,flipX:false,flipY:false,theta:0,opacity:1,angle:0,cornersize:10,padding:0,borderColor:"rgba(102,153,255,0.75)",cornerColor:"rgba(102,153,255,0.5)",fill:"rgb(0,0,0)",overlayFill:null,stroke:null,strokeWidth:1,fillRule:"source-over",borderOpacityWhenMoving:0.4,borderScaleFactor:1,transformMatrix:null},callSuper:function(a){var c=this.constructor.superclass.prototype[a];return arguments.length>1?c.apply(this,e.call(arguments,1)):c.call(this)},
initialize:function(a){this.setOptions(a);this._importProperties();this.originalState={};this.setCoords();this.saveState()},setOptions:function(a){this.options=o(this._getOptions(),a)},_getOptions:function(){return o(f(this._getSuperOptions()),this.options)},_getSuperOptions:function(){var a=this.constructor;if(a)if(a=a.superclass)if((a=a.prototype)&&typeof a._getOptions=="function")return a._getOptions();return{}},_importProperties:function(){this.stateProperties.forEach(function(a){a==="angle"?
this.setAngle(this.options[a]):this[a]=this.options[a]},this)},transform:function(a){a.globalAlpha=this.opacity;a.translate(this.left,this.top);a.rotate(this.theta);a.scale(this.scaleX*(this.flipX?-1:1),this.scaleY*(this.flipY?-1:1))},toObject:function(){var a={type:this.type,left:h(this.left,this.NUM_FRACTION_DIGITS),top:h(this.top,this.NUM_FRACTION_DIGITS),width:h(this.width,this.NUM_FRACTION_DIGITS),height:h(this.height,this.NUM_FRACTION_DIGITS),fill:this.fill,overlayFill:this.overlayFill,stroke:this.stroke,
strokeWidth:this.strokeWidth,scaleX:h(this.scaleX,this.NUM_FRACTION_DIGITS),scaleY:h(this.scaleY,this.NUM_FRACTION_DIGITS),angle:h(this.getAngle(),this.NUM_FRACTION_DIGITS),flipX:this.flipX,flipY:this.flipY,opacity:h(this.opacity,this.NUM_FRACTION_DIGITS)};this.includeDefaultValues||(a=this._removeDefaultValues(a));return a},toDatalessObject:function(){return this.toObject()},_removeDefaultValues:function(a){var c=m.Object.prototype.options;this.stateProperties.forEach(function(g){a[g]===c[g]&&delete a[g]});
return a},isActive:function(){return!!this.active},setActive:function(a){this.active=!!a;return this},toString:function(){return"#<fabric."+p(this.type)+">"},set:function(a,c){if((a==="scaleX"||a==="scaleY")&&c<this.MIN_SCALE_LIMIT)c=this.MIN_SCALE_LIMIT;if(a==="angle")this.setAngle(c);else this[a]=c;return this},toggle:function(a){var c=this.get(a);typeof c==="boolean"&&this.set(a,!c);return this},setSourcePath:function(a){this.sourcePath=a;return this},get:function(a){return a==="angle"?this.getAngle():
this[a]},render:function(a,c){if(!(this.width===0||this.height===0)){a.save();var g=this.transformMatrix;g&&a.setTransform(g[0],g[1],g[2],g[3],g[4],g[5]);c||this.transform(a);if(this.stroke){a.lineWidth=this.strokeWidth;a.strokeStyle=this.stroke}if(this.overlayFill)a.fillStyle=this.overlayFill;else if(this.fill)a.fillStyle=this.fill;this._render(a,c);if(this.active&&!c){this.drawBorders(a);this.hideCorners||this.drawCorners(a)}a.restore()}},getWidth:function(){return this.width*this.scaleX},getHeight:function(){return this.height*
this.scaleY},scale:function(a){this.scaleY=this.scaleX=a;return this},scaleToWidth:function(a){return this.scale(a/this.width)},scaleToHeight:function(a){return this.scale(a/this.height)},setOpacity:function(a){this.set("opacity",a);return this},getAngle:function(){return this.theta*180/Math.PI},setAngle:function(a){this.theta=a/180*Math.PI;this.angle=a;return this},setCoords:function(){this.currentWidth=this.width*this.scaleX;this.currentHeight=this.height*this.scaleY;this._hypotenuse=Math.sqrt(Math.pow(this.currentWidth/
2,2)+Math.pow(this.currentHeight/2,2));this._angle=Math.atan(this.currentHeight/this.currentWidth);var a=Math.cos(this._angle+this.theta)*this._hypotenuse,c=Math.sin(this._angle+this.theta)*this._hypotenuse,g=this.theta,n=Math.sin(g);g=Math.cos(g);a={x:this.left-a,y:this.top-c};c={x:a.x+this.currentWidth*g,y:a.y+this.currentWidth*n};var q={x:a.x-this.currentHeight*n,y:a.y+this.currentHeight*g};this.oCoords={tl:a,tr:c,br:{x:c.x-this.currentHeight*n,y:c.y+this.currentHeight*g},bl:q,ml:{x:a.x-this.currentHeight/
2*n,y:a.y+this.currentHeight/2*g},mt:{x:a.x+this.currentWidth/2*g,y:a.y+this.currentWidth/2*n},mr:{x:c.x-this.currentHeight/2*n,y:c.y+this.currentHeight/2*g},mb:{x:q.x+this.currentWidth/2*g,y:q.y+this.currentWidth/2*n}};this._setCornerCoords();return this},drawBorders:function(a){var c=this.options,g=c.padding,n=g*2;a.save();a.globalAlpha=this.isMoving?c.borderOpacityWhenMoving:1;a.strokeStyle=c.borderColor;c=1/(this.scaleX<this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleX);var q=1/(this.scaleY<
this.MIN_SCALE_LIMIT?this.MIN_SCALE_LIMIT:this.scaleY);a.lineWidth=1/this.borderScaleFactor;a.scale(c,q);c=this.getWidth();q=this.getHeight();a.strokeRect(~~(-(c/2)-g)+0.5,~~(-(q/2)-g)+0.5,~~(c+n),~~(q+n));a.restore();return this},drawCorners:function(a){var c=this.options.cornersize,g=c/2,n=this.options.padding,q=-(this.width/2),s=-(this.height/2),w=c/this.scaleX,y=c/this.scaleY,A=(n+g)/this.scaleY,u=(n+g)/this.scaleX,v=(n+g-c)/this.scaleX;n=(n+g-c)/this.scaleY;a.save();a.globalAlpha=this.isMoving?
this.options.borderOpacityWhenMoving:1;a.fillStyle=this.options.cornerColor;c=q-u;g=s-A;a.fillRect(c,g,w,y);c=q+this.width-u;g=s-A;a.fillRect(c,g,w,y);c=q-u;g=s+this.height+n;a.fillRect(c,g,w,y);c=q+this.width+v;g=s+this.height+n;a.fillRect(c,g,w,y);c=q+this.width/2-u;g=s-A;a.fillRect(c,g,w,y);c=q+this.width/2-u;g=s+this.height+n;a.fillRect(c,g,w,y);c=q+this.width+v;g=s+this.height/2-A;a.fillRect(c,g,w,y);c=q-u;g=s+this.height/2-A;a.fillRect(c,g,w,y);a.restore();return this},clone:function(a){if(this.constructor.fromObject)return this.constructor.fromObject(this.toObject(),
a);return new m.Object(this.toObject())},cloneAsImage:function(a){if(m.Image){var c=new Image;c.onload=function(){a&&a(new m.Image(c),g);c=c.onload=null};var g={angle:this.get("angle"),flipX:this.get("flipX"),flipY:this.get("flipY")};this.set("angle",0).set("flipX",false).set("flipY",false);c.src=this.toDataURL()}return this},toDataURL:function(){var a=document.createElement("canvas");a.width=this.getWidth();a.height=this.getHeight();m.util.wrapElement(a,"div");var c=new m.Element(a);c.backgroundColor=
"transparent";c.renderAll();var g=this.clone();g.left=a.width/2;g.top=a.height/2;g.setActive(false);c.add(g);a=c.toDataURL("png");c.dispose();return a},hasStateChanged:function(){return this.stateProperties.some(function(a){return this[a]!==this.originalState[a]},this)},saveState:function(){this.stateProperties.forEach(function(a){this.originalState[a]=this.get(a)},this);return this},intersectsWithRect:function(a,c){var g=this.oCoords,n=new m.Point(g.tl.x,g.tl.y),q=new m.Point(g.tr.x,g.tr.y),s=new m.Point(g.bl.x,
g.bl.y);g=new m.Point(g.br.x,g.br.y);return m.Intersection.intersectPolygonRectangle([n,q,g,s],a,c).status==="Intersection"},intersectsWithObject:function(a){function c(n){return{tl:new m.Point(n.tl.x,n.tl.y),tr:new m.Point(n.tr.x,n.tr.y),bl:new m.Point(n.bl.x,n.bl.y),br:new m.Point(n.br.x,n.br.y)}}var g=c(this.oCoords);a=c(a.oCoords);return m.Intersection.intersectPolygonPolygon([g.tl,g.tr,g.br,g.bl],[a.tl,a.tr,a.br,a.bl]).status==="Intersection"},isContainedWithinRect:function(a,c){var g=this.oCoords,
n=new m.Point(g.tl.x,g.tl.y),q=new m.Point(g.tr.x,g.tr.y),s=new m.Point(g.bl.x,g.bl.y);new m.Point(g.br.x,g.br.y);return n.x>a.x&&q.x<c.x&&n.y>a.y&&s.y<c.y},isType:function(a){return this.type===a},_findTargetCorner:function(a,c){var g=l(a),n=g.x-c.left;g=g.y-c.top;var q;for(var s in this.oCoords){q=this._getImageLines(this.oCoords[s].corner,s);q=this._findCrossPoints(n,g,q);if(q%2==1&&q!=0)return this.__corner=s}return false},_findCrossPoints:function(a,c,g){var n,q,s,w=0;for(var y in g){s=g[y];
if(!(s.o.y<c&&s.d.y<c))if(!(s.o.y>=c&&s.d.y>=c)){if(s.o.x==s.d.x&&s.o.x>=a)n=s.o.x;else{n=(s.d.y-s.o.y)/(s.d.x-s.o.x);q=c-0*a;s=s.o.y-n*s.o.x;n=-(q-s)/(0-n)}if(n>=a)w+=1;if(w==2)break}}return w},_getImageLines:function(a){return{topline:{o:a.tl,d:a.tr},rightline:{o:a.tr,d:a.br},bottomline:{o:a.br,d:a.bl},leftline:{o:a.bl,d:a.tl}}},_setCornerCoords:function(){var a=this.oCoords,c=this.theta,g=this.cornersize*Math.cos(c),n=this.cornersize*Math.sin(c);c=this.cornersize/2;var q=c-n;a.tl.x-=q;a.tl.y-=
c;a.tl.corner={tl:{x:a.tl.x,y:a.tl.y},tr:{x:a.tl.x+g,y:a.tl.y+n},bl:{x:a.tl.x-n,y:a.tl.y+g}};a.tl.corner.br={x:a.tl.corner.tr.x-n,y:a.tl.corner.tr.y+g};a.tl.x+=q;a.tl.y+=c;a.tr.x+=c;a.tr.y-=c;a.tr.corner={tl:{x:a.tr.x-g,y:a.tr.y-n},tr:{x:a.tr.x,y:a.tr.y},br:{x:a.tr.x-n,y:a.tr.y+g}};a.tr.corner.bl={x:a.tr.corner.tl.x-n,y:a.tr.corner.tl.y+g};a.tr.x-=c;a.tr.y+=c;a.bl.x-=c;a.bl.y+=c;a.bl.corner={tl:{x:a.bl.x+n,y:a.bl.y-g},bl:{x:a.bl.x,y:a.bl.y},br:{x:a.bl.x+g,y:a.bl.y+n}};a.bl.corner.tr={x:a.bl.corner.br.x+
n,y:a.bl.corner.br.y-g};a.bl.x+=c;a.bl.y-=c;a.br.x+=c;a.br.y+=c;a.br.corner={tr:{x:a.br.x+n,y:a.br.y-g},bl:{x:a.br.x-g,y:a.br.y-n},br:{x:a.br.x,y:a.br.y}};a.br.corner.tl={x:a.br.corner.bl.x+n,y:a.br.corner.bl.y-g};a.br.x-=c;a.br.y-=c;a.ml.x-=c;a.ml.y-=c;a.ml.corner={tl:{x:a.ml.x,y:a.ml.y},tr:{x:a.ml.x+g,y:a.ml.y+n},bl:{x:a.ml.x-n,y:a.ml.y+g}};a.ml.corner.br={x:a.ml.corner.tr.x-n,y:a.ml.corner.tr.y+g};a.ml.x+=c;a.ml.y+=c;a.mt.x-=c;a.mt.y-=c;a.mt.corner={tl:{x:a.mt.x,y:a.mt.y},tr:{x:a.mt.x+g,y:a.mt.y+
n},bl:{x:a.mt.x-n,y:a.mt.y+g}};a.mt.corner.br={x:a.mt.corner.tr.x-n,y:a.mt.corner.tr.y+g};a.mt.x+=c;a.mt.y+=c;a.mr.x-=c;a.mr.y-=c;a.mr.corner={tl:{x:a.mr.x,y:a.mr.y},tr:{x:a.mr.x+g,y:a.mr.y+n},bl:{x:a.mr.x-n,y:a.mr.y+g}};a.mr.corner.br={x:a.mr.corner.tr.x-n,y:a.mr.corner.tr.y+g};a.mr.x+=c;a.mr.y+=c;a.mb.x-=c;a.mb.y-=c;a.mb.corner={tl:{x:a.mb.x,y:a.mb.y},tr:{x:a.mb.x+g,y:a.mb.y+n},bl:{x:a.mb.x-n,y:a.mb.y+g}};a.mb.corner.br={x:a.mb.corner.tr.x-n,y:a.mb.corner.tr.y+g};a.mb.x+=c;a.mb.y+=c;a=a.mb.corner;
a.tl.x-=c;a.tl.y-=c;a.tr.x-=c;a.tr.y-=c;a.br.x-=c;a.br.y-=c;a.bl.x-=c;a.bl.y-=c},toGrayscale:function(){var a=this.get("fill");a&&this.set("overlayFill",(new m.Color(a)).toGrayscale().toRgb());return this},complexity:function(){return 0},getCenter:function(){return{x:this.get("left")+this.width/2,y:this.get("top")+this.height/2}},straighten:function(){this.setAngle(this._getAngleValueForStraighten());return this},fxStraighten:function(a){a=a||{};var c=function(){},g=a.onComplete||c,n=a.onChange||
c,q=this;m.util.animate({startValue:this.get("angle"),endValue:this._getAngleValueForStraighten(),duration:this.FX_DURATION,onChange:function(s){q.setAngle(s);n()},onComplete:function(){q.setCoords();g()},onStart:function(){q.setActive(false)}});return this},fxRemove:function(a){a||(a={});var c=function(){},g=a.onComplete||c,n=a.onChange||c,q=this;m.util.animate({startValue:this.get("opacity"),endValue:0,duration:this.FX_DURATION,onChange:function(s){q.set("opacity",s);n()},onComplete:g,onStart:function(){q.setActive(false)}});
return this},_getAngleValueForStraighten:function(){var a=this.get("angle");if(a>-225&&a<=-135)return-180;else if(a>-135&&a<=-45)return-90;else if(a>-45&&a<=45)return 0;else if(a>45&&a<=135)return 90;else if(a>135&&a<=225)return 180;else if(a>225&&a<=315)return 270;else if(a>315)return 360;return 0},toJSON:function(){return this.toObject()}});m.Object.prototype.rotate=m.Object.prototype.setAngle}})();
(function(){var m=this.fabric||(this.fabric={}),o=m.util.object.extend;if(m.Line)m.warn("fabric.Line is already defined");else{m.Line=m.util.createClass(m.Object,{type:"line",initialize:function(f,h){f||(f=[0,0,0,0]);this.callSuper("initialize",h);this.set("x1",f[0]);this.set("y1",f[1]);this.set("x2",f[2]);this.set("y2",f[3]);this.set("width",this.x2-this.x1);this.set("height",this.y2-this.y1);this.set("left",this.x1+this.width/2);this.set("top",this.y1+this.height/2)},_render:function(f){f.beginPath();
f.moveTo(-this.width/2,-this.height/2);f.lineTo(this.width/2,this.height/2);var h=f.strokeStyle;f.strokeStyle=f.fillStyle;f.stroke();f.strokeStyle=h},complexity:function(){return 1},toObject:function(){return o(this.callSuper("toObject"),{x1:this.get("x1"),y1:this.get("y1"),x2:this.get("x2"),y2:this.get("y2")})}});m.Line.ATTRIBUTE_NAMES="x1 y1 x2 y2 stroke stroke-width transform".split(" ");m.Line.fromElement=function(f,h){var p=m.parseAttributes(f,m.Line.ATTRIBUTE_NAMES);return new m.Line([p.x1||
0,p.y1||0,p.x2||0,p.y2||0],o(p,h))};m.Line.fromObject=function(f){return new m.Line([f.x1,f.y1,f.x2,f.y2],f)}}})();
(function(){var m=this.fabric||(this.fabric={}),o=Math.PI*2,f=m.util.object.extend;if(m.Circle)m.warn("fabric.Circle is already defined.");else{m.Circle=m.util.createClass(m.Object,{type:"circle",initialize:function(h){h=h||{};this.set("radius",h.radius||0);this.callSuper("initialize",h);h=this.get("radius")*2*this.get("scaleX");this.set("width",h).set("height",h)},toObject:function(){return f(this.callSuper("toObject"),{radius:this.get("radius")})},_render:function(h,p){h.beginPath();h.arc(p?this.left:
0,p?this.top:0,this.radius,0,o,false);h.closePath();this.fill&&h.fill();this.stroke&&h.stroke()},complexity:function(){return 1}});m.Circle.ATTRIBUTE_NAMES="cx cy r fill fill-opacity stroke stroke-width transform".split(" ");m.Circle.fromElement=function(h,p){p||(p={});var l=m.parseAttributes(h,m.Circle.ATTRIBUTE_NAMES);if(!("radius"in l&&l.radius>0))throw Error("value of `r` attribute is required and can not be negative");if("left"in l)l.left-=p.width/2||0;if("top"in l)l.top-=p.height/2||0;return new m.Circle(f(l,
p))};m.Circle.fromObject=function(h){return new m.Circle(h)}}})();
(function(){var m=this.fabric||(this.fabric={});if(m.Triangle)m.warn("fabric.Triangle is already defined");else{m.Triangle=m.util.createClass(m.Object,{type:"triangle",initialize:function(o){o=o||{};this.callSuper("initialize",o);this.set("width",o.width||100).set("height",o.height||100)},_render:function(o){var f=this.width/2,h=this.height/2;o.beginPath();o.moveTo(-f,h);o.lineTo(0,-h);o.lineTo(f,h);o.closePath();this.fill&&o.fill();this.stroke&&o.stroke()},complexity:function(){return 1}});m.Triangle.fromObject=
function(o){return new m.Triangle(o)}}})();
(function(){var m=this.fabric||(this.fabric={}),o=Math.PI*2,f=m.util.object.extend;if(m.Ellipse)m.warn("fabric.Ellipse is already defined.");else{m.Ellipse=m.util.createClass(m.Object,{type:"ellipse",initialize:function(h){h=h||{};this.callSuper("initialize",h);this.set("rx",h.rx||0);this.set("ry",h.ry||0);this.set("width",this.get("rx")*2);this.set("height",this.get("ry")*2)},toObject:function(){return f(this.callSuper("toObject"),{rx:this.get("rx"),ry:this.get("ry")})},render:function(h,p){if(!(this.rx===
0||this.ry===0))return this.callSuper("render",h,p)},_render:function(h,p){h.beginPath();h.save();h.transform(1,0,0,this.ry/this.rx,0,0);h.arc(p?this.left:0,p?this.top:0,this.rx,0,o,false);h.restore();this.stroke&&h.stroke();this.fill&&h.fill()},complexity:function(){return 1}});m.Ellipse.ATTRIBUTE_NAMES="cx cy rx ry fill fill-opacity stroke stroke-width transform".split(" ");m.Ellipse.fromElement=function(h,p){p||(p={});var l=m.parseAttributes(h,m.Ellipse.ATTRIBUTE_NAMES);if("left"in l)l.left-=p.width/
2||0;if("top"in l)l.top-=p.height/2||0;return new m.Ellipse(f(l,p))};m.Ellipse.fromObject=function(h){return new m.Ellipse(h)}}})();
(function(){var m=this.fabric||(this.fabric={});if(m.Rect)console.warn("fabric.Rect is already defined");else{m.Rect=m.util.createClass(m.Object,{type:"rect",options:{rx:0,ry:0},initialize:function(o){this.callSuper("initialize",o);this._initRxRy()},_initRxRy:function(){if(this.options.rx&&!this.options.ry)this.options.ry=this.options.rx;else if(this.options.ry&&!this.options.rx)this.options.rx=this.options.ry},_render:function(o){var f=this.options.rx||0,h=this.options.ry||0,p=-this.width/2,l=-this.height/
2,e=this.width,a=this.height;o.beginPath();o.moveTo(p+f,l);o.lineTo(p+e-f,l);o.bezierCurveTo(p+e,l,p+e,l+h,p+e,l+h);o.lineTo(p+e,l+a-h);o.bezierCurveTo(p+e,l+a,p+e-f,l+a,p+e-f,l+a);o.lineTo(p+f,l+a);o.bezierCurveTo(p,l+a,p,l+a-h,p,l+a-h);o.lineTo(p,l+h);o.bezierCurveTo(p,l,p+f,l,p+f,l);o.closePath();this.fill&&o.fill();this.stroke&&o.stroke()},_normalizeLeftTopProperties:function(o){o.left&&this.set("left",o.left+this.getWidth()/2);o.top&&this.set("top",o.top+this.getHeight()/2);return this},complexity:function(){return 1}});
m.Rect.ATTRIBUTE_NAMES="x y width height rx ry fill fill-opacity stroke stroke-width transform".split(" ");m.Rect.fromElement=function(o,f){if(!o)return null;var h=m.parseAttributes(o,m.Rect.ATTRIBUTE_NAMES);h=h;h.left=h.left||0;h.top=h.top||0;h=h;var p=new m.Rect(m.util.object.extend(f||{},h));p._normalizeLeftTopProperties(h);return p};m.Rect.fromObject=function(o){return new m.Rect(o)}}})();
(function(){var m=this.fabric||(this.fabric={});if(m.Polyline)m.warn("fabric.Polyline is already defined");else{m.Polyline=m.util.createClass(m.Object,{type:"polyline",initialize:function(o,f){f=f||{};this.set("points",o);this.callSuper("initialize",f);this._calcDimensions()},_calcDimensions:function(){return m.Polygon.prototype._calcDimensions.call(this)},toObject:function(){return m.Polygon.prototype.toObject.call(this)},_render:function(o){var f;o.beginPath();for(var h=0,p=this.points.length;h<
p;h++){f=this.points[h];o.lineTo(f.x,f.y)}this.fill&&o.fill();this.stroke&&o.stroke()},complexity:function(){return this.get("points").length}});m.Polyline.ATTRIBUTE_NAMES="fill fill-opacity stroke stroke-width transform".split(" ");m.Polyline.fromElement=function(o,f){if(!o)return null;f||(f={});for(var h=m.parsePointsAttribute(o.getAttribute("points")),p=m.parseAttributes(o,m.Polyline.ATTRIBUTE_NAMES),l=0,e=h.length;l<e;l++){h[l].x-=f.width/2||0;h[l].y-=f.height/2||0}return new m.Polyline(h,m.util.object.extend(p,
f))};m.Polyline.fromObject=function(o){return new m.Polyline(o.points,o)}}})();
(function(){var m=this.fabric||(this.fabric={}),o=m.util.object.extend,f=m.util.array.min,h=m.util.array.max;if(m.Polygon)m.warn("fabric.Polygon is already defined");else{m.Polygon=m.util.createClass(m.Object,{type:"polygon",initialize:function(p,l){l=l||{};this.points=p;this.callSuper("initialize",l);this._calcDimensions()},_calcDimensions:function(){var p=this.points,l=f(p,"x"),e=f(p,"y"),a=h(p,"x");p=h(p,"y");this.width=a-l;this.height=p-e;this.minX=l;this.minY=e},toObject:function(){return o(this.callSuper("toObject"),
{points:this.points.concat()})},_render:function(p){var l;p.beginPath();for(var e=0,a=this.points.length;e<a;e++){l=this.points[e];p.lineTo(l.x,l.y)}this.fill&&p.fill();if(this.stroke){p.closePath();p.stroke()}},complexity:function(){return this.points.length}});m.Polygon.ATTRIBUTE_NAMES="fill fill-opacity stroke stroke-width transform".split(" ");m.Polygon.fromElement=function(p,l){if(!p)return null;l||(l={});for(var e=m.parsePointsAttribute(p.getAttribute("points")),a=m.parseAttributes(p,m.Polygon.ATTRIBUTE_NAMES),
c=0,g=e.length;c<g;c++){e[c].x-=l.width/2||0;e[c].y-=l.height/2||0}return new m.Polygon(e,o(a,l))};m.Polygon.fromObject=function(p){return new m.Polygon(p.points,p)}}})();
(function(){function m(e){if(e[0]==="H")return e[1];return e[e.length-2]}function o(e){if(e[0]==="V")return e[1];return e[e.length-1]}var f=this.fabric||(this.fabric={}),h=f.util.array.min,p=f.util.array.max,l=f.util.object.extend;if(f.Path)f.warn("fabric.Path is already defined");else if(f.Object){f.Path=f.util.createClass(f.Object,{type:"path",initialize:function(e,a){a=a||{};this.setOptions(a);this._importProperties();this.originalState={};if(!e)throw Error("`path` argument is required");var c=
Object.prototype.toString.call(e)==="[object Array]";if(this.path=c?e:e.match&&e.match(/[a-zA-Z][^a-zA-Z]*/g)){c||this._initializeFromArray(a);this.setCoords();a.sourcePath&&this.setSourcePath(a.sourcePath)}},_initializeFromArray:function(e){var a="width"in e;e="height"in e;this.path=this._parsePath();if(!a||!e){l(this,this._parseDimensions());if(a)this.width=this.options.width;if(e)this.height=this.options.height}},_render:function(e){for(var a,c=0,g=0,n=0,q=0,s,w,y=-(this.width/2),A=-(this.height/
2),u=0,v=this.path.length;u<v;++u){a=this.path[u];switch(a[0]){case "l":c+=a[1];g+=a[2];e.lineTo(c+y,g+A);break;case "L":c=a[1];g=a[2];e.lineTo(c+y,g+A);break;case "h":c+=a[1];e.lineTo(c+y,g+A);break;case "H":c=a[1];e.lineTo(c+y,g+A);break;case "v":g+=a[1];e.lineTo(c+y,g+A);break;case "V":g=a[1];e.lineTo(c+y,g+A);break;case "m":c+=a[1];g+=a[2];e.moveTo(c+y,g+A);break;case "M":c=a[1];g=a[2];e.moveTo(c+y,g+A);break;case "c":s=c+a[5];w=g+a[6];n=c+a[3];q=g+a[4];e.bezierCurveTo(c+a[1]+y,g+a[2]+A,n+y,q+
A,s+y,w+A);c=s;g=w;break;case "C":c=a[5];g=a[6];n=a[3];q=a[4];e.bezierCurveTo(a[1]+y,a[2]+A,n+y,q+A,c+y,g+A);break;case "s":s=c+a[3];w=g+a[4];n=2*c-n;q=2*g-q;e.bezierCurveTo(n+y,q+A,c+a[1]+y,g+a[2]+A,s+y,w+A);c=s;g=w;break;case "S":s=a[3];w=a[4];n=2*c-n;q=2*g-q;e.bezierCurveTo(n+y,q+A,a[1]+y,a[2]+A,s+y,w+A);c=s;g=w;break;case "q":c+=a[3];g+=a[4];e.quadraticCurveTo(a[1]+y,a[2]+A,c+y,g+A);break;case "Q":c=a[3];g=a[4];n=a[1];q=a[2];e.quadraticCurveTo(n+y,q+A,c+y,g+A);break;case "T":s=c;w=g;c=a[1];g=
a[2];n=-n+2*s;q=-q+2*w;e.quadraticCurveTo(n+y,q+A,c+y,g+A);break;case "a":break;case "A":break;case "z":case "Z":e.closePath();break}}},render:function(e,a){e.save();var c=this.transformMatrix;c&&e.transform(c[0],c[1],c[2],c[3],c[4],c[5]);a||this.transform(e);if(this.overlayFill)e.fillStyle=this.overlayFill;else if(this.fill)e.fillStyle=this.fill;if(this.stroke)e.strokeStyle=this.stroke;e.beginPath();this._render(e);this.fill&&e.fill();if(this.stroke){e.strokeStyle=this.stroke;e.lineWidth=this.strokeWidth;
e.lineCap=e.lineJoin="round";e.stroke()}if(!a&&this.active){this.drawBorders(e);this.hideCorners||this.drawCorners(e)}e.restore()},toString:function(){return"#<fabric.Path ("+this.complexity()+"): "+JSON.stringify({top:this.top,left:this.left})+">"},toObject:function(){var e=l(this.callSuper("toObject"),{path:this.path});if(this.sourcePath)e.sourcePath=this.sourcePath;if(this.transformMatrix)e.transformMatrix=this.transformMatrix;return e},toDatalessObject:function(){var e=this.toObject();if(this.sourcePath)e.path=
this.sourcePath;delete e.sourcePath;return e},complexity:function(){return this.path.length},_parsePath:function(){for(var e=[],a,c,g=0,n=this.path.length;g<n;g++){a=this.path[g];c=a.slice(1).trim().replace(/(\d)-/g,"$1###-").split(/\s|,|###/);e.push([a.charAt(0)].concat(c.map(parseFloat)))}return e},_parseDimensions:function(){var e=[],a=[],c,g,n=false,q,s;this.path.forEach(function(u,v){if(u[0]!=="H")c=v===0?m(u):m(this.path[v-1]);if(u[0]!=="V")g=v===0?o(u):o(this.path[v-1]);if(u[0]===u[0].toLowerCase())n=
true;q=n?c+m(u):u[0]==="V"?c:m(u);s=n?g+o(u):u[0]==="H"?g:o(u);var E=parseInt(q,10);isNaN(E)||e.push(E);E=parseInt(s,10);isNaN(E)||a.push(E)},this);var w=h(e),y=h(a),A=deltaY=0;w={top:y-deltaY,left:w-A,bottom:p(a)-deltaY,right:p(e)-A};w.width=w.right-w.left;w.height=w.bottom-w.top;return w}});f.Path.fromObject=function(e){return new f.Path(e.path,e)};f.Path.ATTRIBUTE_NAMES="d fill fill-opacity fill-rule stroke stroke-width transform".split(" ");f.Path.fromElement=function(e,a){var c=f.parseAttributes(e,
f.Path.ATTRIBUTE_NAMES),g=c.d;delete c.d;return new f.Path(g,l(c,a))}}else f.warn("fabric.Path requires fabric.Object")})();
(function(){var m=this.fabric||(this.fabric={}),o=m.util.object.extend,f=m.util.array.invoke,h=m.Object.prototype.set,p=m.Object.prototype.toObject,l=m.util.string.camelize,e=m.util.string.capitalize;if(m.PathGroup)m.warn("fabric.PathGroup is already defined");else{m.PathGroup=m.util.createClass(m.Path,{type:"path-group",forceFillOverwrite:false,initialize:function(a,c){c=c||{};this.originalState={};this.paths=a;this.setOptions(c);this._initProperties();this.setCoords();c.sourcePath&&this.setSourcePath(c.sourcePath)},
_initProperties:function(){this.stateProperties.forEach(function(a){if(a==="fill")this.set(a,this.options[a]);else if(a==="angle")this.setAngle(this.options[a]);else this[a]=this.options[a]},this)},render:function(a){if(this.stub){a.save();this.transform(a);this.stub.render(a,false);if(this.active){this.drawBorders(a);this.drawCorners(a)}}else{a.save();var c=this.transformMatrix;c&&a.transform(c[0],c[1],c[2],c[3],c[4],c[5]);this.transform(a);c=0;for(var g=this.paths.length;c<g;++c)this.paths[c].render(a,
true);if(this.active){this.drawBorders(a);this.hideCorners||this.drawCorners(a)}}a.restore()},set:function(a,c){if((a==="fill"||a==="overlayFill")&&this.isSameColor()){this[a]=c;for(var g=this.paths.length;g--;)this.paths[g].set(a,c)}else h.call(this,a,c);return this},toObject:function(){return o(p.call(this),{paths:f(this.getObjects(),"clone"),sourcePath:this.sourcePath})},toDatalessObject:function(){var a=this.toObject();if(this.sourcePath)a.paths=this.sourcePath;return a},toString:function(){return"#<fabric.PathGroup ("+
this.complexity()+"): { top: "+this.top+", left: "+this.left+" }>"},isSameColor:function(){var a=this.getObjects()[0].get("fill");return this.getObjects().every(function(c){return c.get("fill")===a})},complexity:function(){return this.paths.reduce(function(a,c){return a+(c&&c.complexity?c.complexity():0)},0)},toGrayscale:function(){for(var a=this.paths.length;a--;)this.paths[a].toGrayscale();return this},getObjects:function(){return this.paths}});m.PathGroup.fromObject=function(a){for(var c=a.paths,
g=0,n=c.length;g<n;g++)if(!(c[g]instanceof m.Object)){var q=l(e(c[g].type));c[g]=m[q].fromObject(c[g])}return new m.PathGroup(c,a)}}})();
(function(){var m=this.fabric||(this.fabric={}),o=m.util.object.extend,f=m.util.array.min,h=m.util.array.max,p=m.util.array.invoke,l=m.util.removeFromArray;if(!m.Group){m.Group=m.util.createClass(m.Object,{type:"group",initialize:function(e,a){this.objects=e||[];this.originalState={};this.callSuper("initialize");this._calcBounds();this._updateObjectsCoords();a&&o(this,a);this._setOpacityIfSame();this.setCoords(true);this.saveCoords();this.activateAllObjects()},_updateObjectsCoords:function(){var e=
this.left,a=this.top;this.forEachObject(function(c){var g=c.get("left"),n=c.get("top");c.set("originalLeft",g);c.set("originalTop",n);c.set("left",g-e);c.set("top",n-a);c.setCoords();c.hideCorners=true},this)},toString:function(){return"#<fabric.Group: ("+this.complexity()+")>"},getObjects:function(){return this.objects},add:function(e){this._restoreObjectsState();this.objects.push(e);e.setActive(true);this._calcBounds();this._updateObjectsCoords();return this},remove:function(e){this._restoreObjectsState();
l(this.objects,e);e.setActive(false);this._calcBounds();this._updateObjectsCoords();return this},size:function(){return this.getObjects().length},set:function(e,a){if(typeof a=="function")this.set(e,a(this[e]));else if(e==="fill"||e==="opacity"){var c=this.objects.length;for(this[e]=a;c--;)this.objects[c].set(e,a)}else this[e]=a;return this},contains:function(e){return this.objects.indexOf(e)>-1},toObject:function(){return o(this.callSuper("toObject"),{objects:p(this.objects,"clone")})},render:function(e){e.save();
this.transform(e);for(var a=Math.max(this.scaleX,this.scaleY),c=0,g;g=this.objects[c];c++){var n=g.borderScaleFactor;g.borderScaleFactor=a;g.render(e);g.borderScaleFactor=n}this.hideBorders||this.drawBorders(e);this.hideCorners||this.drawCorners(e);e.restore();this.setCoords()},item:function(e){return this.getObjects()[e]},complexity:function(){return this.getObjects().reduce(function(e,a){e+=typeof a.complexity=="function"?a.complexity():0;return e},0)},_restoreObjectsState:function(){this.objects.forEach(this._restoreObjectState,
this);return this},_restoreObjectState:function(e){var a=this.get("left"),c=this.get("top"),g=this.getAngle()*(Math.PI/180);e.get("originalLeft");e.get("originalTop");var n=Math.cos(g)*e.get("top")+Math.sin(g)*e.get("left");g=-Math.sin(g)*e.get("top")+Math.cos(g)*e.get("left");e.setAngle(e.getAngle()+this.getAngle());e.set("left",a+g*this.get("scaleX"));e.set("top",c+n*this.get("scaleY"));e.set("scaleX",e.get("scaleX")*this.get("scaleX"));e.set("scaleY",e.get("scaleY")*this.get("scaleY"));e.setCoords();
e.hideCorners=false;e.setActive(false);e.setCoords();return this},destroy:function(){return this._restoreObjectsState()},saveCoords:function(){this._originalLeft=this.get("left");this._originalTop=this.get("top");return this},hasMoved:function(){return this._originalLeft!==this.get("left")||this._originalTop!==this.get("top")},setObjectsCoords:function(){this.forEachObject(function(e){e.setCoords()});return this},activateAllObjects:function(){return this.setActive(true)},setActive:function(e){this.forEachObject(function(a){a.setActive(e)});
return this},forEachObject:function(e,a){for(var c=this.getObjects(),g=c.length;g--;)e.call(a,c[g],g,c);return this},_setOpacityIfSame:function(){var e=this.getObjects(),a=e[0]?e[0].get("opacity"):1;if(e.every(function(c){return c.get("opacity")===a}))this.opacity=a},_calcBounds:function(){var e=[],a=[],c,g;g=0;for(var n=this.objects.length;g<n;++g){c=this.objects[g];c.setCoords();for(var q in c.oCoords){e.push(c.oCoords[q].x);a.push(c.oCoords[q].y)}}c=f(e);g=h(e);e=f(a);a=h(a);g=g-c;a=a-e;this.width=
g;this.height=a;this.left=c+g/2;this.top=e+a/2},containsPoint:function(e){var a=this.get("width")/2,c=this.get("height")/2,g=this.get("left"),n=this.get("top");return g-a<e.x&&g+a>e.x&&n-c<e.y&&n+c>e.y},toGrayscale:function(){for(var e=this.objects.length;e--;)this.objects[e].toGrayscale()}});m.Group.fromObject=function(e){return new m.Group(e.objects,e)}}})();
(function(){var m=this.fabric||(this.fabric={}),o=m.util.object.extend,f=m.util.object.clone;if(m.Text)m.warn("fabric.Text is already defined");else if(m.Object){m.Text=m.util.createClass(m.Object,{options:{top:10,left:10,fontsize:20,fontweight:100,fontfamily:"Modernist_One_400",path:null},type:"text",initialize:function(h,p){this.originalState={};this._initStateProperties();this.text=h;this.setOptions(p);o(this,this.options);this.theta=this.angle*(Math.PI/180);this.width=this.getWidth();this.setCoords()},
_initStateProperties:function(){var h;if((h=this.constructor)&&(h=h.superclass)&&(h=h.prototype)&&(h=h.stateProperties)&&h.clone){this.stateProperties=h.clone();this.stateProperties.push("fontfamily","fontweight","path")}},toString:function(){return"#<fabric.Text ("+this.complexity()+"): "+JSON.stringify({text:this.text,fontfamily:this.fontfamily})+">"},_render:function(h){var p=Cufon.textOptions||(Cufon.textOptions={});p.left=this.left;p.top=this.top;p.context=h;p.color=this.fill;var l=this._initDummyElement();
this.transform(h);Cufon.replaceElement(l,{separate:"none",fontFamily:this.fontfamily});this.width=p.width;this.height=p.height},_initDummyElement:function(){var h=document.createElement("div");h.innerHTML=this.text;h.style.fontSize="40px";h.style.fontWeight="400";h.style.fontStyle="normal";h.style.letterSpacing="normal";h.style.color="#000000";h.style.fontWeight="600";h.style.fontFamily="Verdana";return h},render:function(h){h.save();this._render(h);if(this.active){this.drawBorders(h);this.drawCorners(h)}h.restore()},
toObject:function(){return o(this.callSuper("toObject"),{text:this.text,fontsize:this.fontsize,fontweight:this.fontweight,fontfamily:this.fontfamily,path:this.path})},setColor:function(h){this.set("fill",h);return this},setFontsize:function(h){this.set("fontsize",h);this.setCoords();return this},getText:function(){return this.text},setText:function(h){this.set("text",h);this.setCoords();return this},set:function(h,p){this[h]=p;if(h==="fontfamily")this.path=this.path.replace(/(.*?)([^\/]*)(\.font\.js)/,
"$1"+p+"$3");return this}});m.Text.fromObject=function(h){return new m.Text(h.text,f(h))};m.Text.fromElement=function(){}}else m.warn("fabric.Text requires fabric.Object")})();
(function(){var m=fabric.util.object.extend;if(!this.fabric)this.fabric={};if(this.fabric.Image)fabric.warn("fabric.Image is already defined.");else if(fabric.Object){fabric.Image=fabric.util.createClass(fabric.Object,{maxwidth:null,maxheight:null,active:false,bordervisibility:false,cornervisibility:false,type:"image",__isGrayscaled:false,initialize:function(o,f){this.callSuper("initialize",f);this._initElement(o);this._initConfig(f||{})},getElement:function(){return this._element},setElement:function(o){this._element=
o;return this},getNormalizedSize:function(o,f,h){if(h&&f&&o.width>o.height&&o.width/o.height<f/h){normalizedWidth=~~(o.width*h/o.height);normalizedHeight=h}else if(h&&(o.height==o.width||o.height>o.width||o.height>h)){normalizedWidth=~~(o.width*h/o.height);normalizedHeight=h}else if(f&&f<o.width){normalizedHeight=~~(o.height*f/o.width);normalizedWidth=f}else{normalizedWidth=o.width;normalizedHeight=o.height}return{width:normalizedWidth,height:normalizedHeight}},getOriginalSize:function(){var o=this.getElement();
return{width:o.width,height:o.height}},setBorderVisibility:function(){this._resetWidthHeight();this._adjustWidthHeightToBorders(showBorder);this.setCoords()},setCornersVisibility:function(o){this.cornervisibility=!!o},render:function(o,f){o.save();f||this.transform(o);this._render(o);if(this.active&&!f){this.drawBorders(o);this.hideCorners||this.drawCorners(o)}o.restore()},toObject:function(){return m(this.callSuper("toObject"),{src:this.getSrc()})},getSrc:function(){return this.getElement().src},
toString:function(){return'#<fabric.Image: { src: "'+this.getSrc()+'" }>'},clone:function(o){this.constructor.fromObject(this.toObject(),o)},toGrayscale:function(o){if(!this.__isGrayscaled){var f=this.getElement(),h=document.createElement("canvas"),p=document.createElement("img"),l=this;h.width=f.width;h.height=f.height;h.getContext("2d").drawImage(f,0,0);fabric.Element.toGrayscale(h);p.onload=function(){l.setElement(p);o&&o();p.onload=h=f=imageData=null};p.width=f.width;p.height=f.height;p.src=h.toDataURL("image/png");
this.__isGrayscaled=true;return this}},_render:function(o){var f=this.getOriginalSize();o.drawImage(this.getElement(),-f.width/2,-f.height/2,f.width,f.height)},_adjustWidthHeightToBorders:function(o){if(o){this.currentBorder=this.borderwidth;this.width+=2*this.currentBorder;this.height+=2*this.currentBorder}else this.currentBorder=0},_resetWidthHeight:function(){var o=this.getElement();this.set("width",o.width);this.set("height",o.height)},_initElement:function(o){this.setElement(fabric.util.getById(o));
fabric.util.addClass(this.getElement(),fabric.Image.CSS_CANVAS)},_initConfig:function(o){this.setOptions(o);this._setBorder();this._setWidthHeight(o)},_setBorder:function(){this.currentBorder=this.bordervisibility?this.borderwidth:0},_setWidthHeight:function(){var o=2*this.currentBorder;this.width=(this.getElement().width||0)+o;this.height=(this.getElement().height||0)+o},complexity:function(){return 1}});fabric.Image.CSS_CANVAS="canvas-img";fabric.Image.fromObject=function(o,f){var h=document.createElement("img"),
p=o.src;if(o.width)h.width=o.width;if(o.height)h.height=o.height;h.onload=function(){f&&f(new fabric.Image(h,o));h=h.onload=null};h.src=p};fabric.Image.fromURL=function(o,f,h){var p=document.createElement("img");p.onload=function(){f&&f(new fabric.Image(p,h));p=p.onload=null};p.src=o}}else fabric.warn("fabric.Object is required for fabric.Image initialization")})();
